{"version":3,"file":"leaflet.distortableimage.js","mappings":"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","sources":["webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/DistortableImageOverlay.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/RotateHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/getEXIFdata.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/util/DomUtil.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/util/MatrixUtil.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/DragAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/iconsets/ToolbarIconSet.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/RotateAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/mapmixins/MapMixins.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/LockAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/util/ImageUtil.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/EditHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/RestoreAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/StackAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/DistortableCollection.Edit.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/UnlockAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/mapmixins/DoubleClickZoom.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/OpacitiesAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/GeolocateAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/util/IconUtil.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/FreeRotateAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/ScaleAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/iconsets/KeymapperIconSet.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/DistortHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/components/DistortableImage.Keymapper.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/DistortableCollection.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/FreeRotateHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/ExportAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/ScaleHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/BorderAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/util/Utils.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/DragHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/toolbars/DistortableImage.ControlBar.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/iconsets/IconSet.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/util/TrigUtil.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/OpacityAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/DistortAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/DeleteAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/mapmixins/BoxCollector.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/toolbars/DistortableImage.PopupBar.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/DistortableImage.Edit.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/mapmixins/DoubleClickLabels.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/actions/EditAction.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/./src/edit/handles/LockHandle.js","webpack://@Hearsee-Mobility/leaflet-distortableimage/webpack/startup"],"sourcesContent":["L.DistortableImageOverlay = L.ImageOverlay.extend({\n  options: {\n    height: 200,\n    crossOrigin: true,\n    // todo: find ideal number to prevent distortions during RotateScale, and make it dynamic (remove hardcoding)\n    edgeMinWidth: 50,\n    editable: true,\n    mode: 'distort',\n    selected: false,\n    interactive: true,\n    tooltipText: '',\n  },\n\n  initialize(url, options) {\n    L.setOptions(this, options);\n    L.Utils.initTranslation.call(this);\n\n    this.edgeMinWidth = this.options.edgeMinWidth;\n    this.editable = this.options.editable;\n    this._selected = this.options.selected;\n    this._url = url;\n    this.rotation = {};\n\n    this.interactive = this.options.interactive;\n    this.tooltipText = this.options.tooltipText;\n  },\n\n  onAdd(map) {\n    this._map = map;\n    if (!this.getElement()) { this._initImage(); }\n\n    map.on('viewreset', this._reset, this);\n\n    if (this.options.corners) {\n      this._corners = this.options.corners;\n      if (map.options.zoomAnimation && L.Browser.any3d) {\n        map.on('zoomanim', this._animateZoom, this);\n      }\n    }\n\n    // Have to wait for the image to load because need to access its w/h\n    L.DomEvent.on(this.getElement(), 'load', () => {\n      this.getPane().appendChild(this.getElement());\n      this._initImageDimensions();\n\n      if (this.options.rotation) {\n        const units = this.options.rotation.deg >= 0 ? 'deg' : 'rad';\n        this.setAngle(this.options.rotation[units], units);\n      } else {\n        this.rotation = {deg: 0, rad: 0};\n        this._reset();\n      }\n\n      /* Initialize default corners if not already set */\n      if (!this._corners) {\n        if (map.options.zoomAnimation && L.Browser.any3d) {\n          map.on('zoomanim', this._animateZoom, this);\n        }\n      }\n\n      /** if there is a featureGroup, only its editable option matters */\n      const eventParents = this._eventParents;\n      if (eventParents) {\n        this.eP = eventParents[Object.keys(eventParents)[0]];\n        if (this.eP.editable) { this.editing.enable(); }\n      } else {\n        if (this.editable) { this.editing.enable(); }\n        this.eP = null;\n      }\n    });\n\n    L.DomEvent.on(this.getElement(), 'click', this.select, this);\n    L.DomEvent.on(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n    }, this);\n\n    /**\n     * custom events fired from DoubleClickLabels.js. Used to differentiate\n     * single / dblclick to not deselect images on map dblclick.\n     */\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.on(map, 'click', this.deselect, this);\n    }\n\n    this.fire('add');\n\n    L.DomEvent.on(this.getElement(), 'mousemove', this.activateTooltip, this);\n    L.DomEvent.on(this.getElement(), 'mouseout', this.closeTooltip, this);\n  },\n\n  onRemove(map) {\n    L.DomEvent.off(this.getElement(), 'click', this.select, this);\n    L.DomEvent.off(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n    }, this);\n    L.DomEvent.off(map, 'click', this.deselect, this);\n\n    if (this.editing) { this.editing.disable(); }\n    this.fire('remove');\n\n    L.ImageOverlay.prototype.onRemove.call(this, map);\n\n    L.DomEvent.on(this.getElement(), 'mouseout', this.closeTooltip, this);\n    L.DomEvent.off(this.getElement(), 'mousemove', this.deactivateTooltip, this);\n  },\n\n  _initImageDimensions() {\n    const map = this._map;\n    const originalImageWidth = L.DomUtil.getStyle(this.getElement(), 'width');\n    const originalImageHeight = L.DomUtil.getStyle(this.getElement(), 'height');\n    const aspectRatio =\n        parseInt(originalImageWidth) / parseInt(originalImageHeight);\n    const imageHeight = this.options.height;\n    const imageWidth = parseInt(aspectRatio * imageHeight);\n    const center = map.project(map.getCenter());\n    const offset = L.point(imageWidth, imageHeight).divideBy(2);\n    if (this.options.corners) {\n      this._corners = this.options.corners;\n    } else {\n      this._corners = [\n        map.unproject(center.subtract(offset)),\n        map.unproject(center.add(L.point(offset.x, -offset.y))),\n        map.unproject(center.add(L.point(-offset.x, offset.y))),\n        map.unproject(center.add(offset)),\n      ];\n    }\n\n    this._initialDimensions = {\n      'center': center,\n      'offset': offset,\n      'zoom': map.getZoom(),\n    };\n    this.setBounds(L.latLngBounds(this.getCorners()));\n  },\n\n  _singleClick(e) {\n    if (e.type === 'singleclick') { this.deselect(); }\n    else { return; }\n  },\n\n  _singleClickListeners() {\n    const map = this._map;\n    L.DomEvent.off(map, 'click', this.deselect, this);\n    L.DomEvent.on(map, 'singleclick', this.deselect, this);\n  },\n\n  _resetClickListeners() {\n    const map = this._map;\n    L.DomEvent.on(map, 'click', this.deselect, this);\n    L.DomEvent.off(map, 'singleclick', this.deselect, this);\n  },\n\n  isSelected() {\n    return this._selected;\n  },\n\n  deselect() {\n    const edit = this.editing;\n    if (!edit.enabled()) { return; }\n\n    edit._removeToolbar();\n    edit._hideMarkers();\n\n    this._selected = false;\n    this.fire('deselect');\n    return this;\n  },\n\n  select(e) {\n    const edit = this.editing;\n    const eP = this.eP;\n\n    if (!edit.enabled()) { return; }\n    if (e) { L.DomEvent.stopPropagation(e); }\n\n    // this ensures deselection of all other images, allowing us to keep collection group optional\n    this._programmaticGrouping();\n\n    this._selected = true;\n    edit._addToolbar();\n    edit._showMarkers();\n    this.fire('select');\n\n    // we run the selection logic 1st anyway because the collection group's _addToolbar method depends on it\n    if (eP && eP.anyCollected()) {\n      this.deselect();\n      return;\n    }\n\n    return this;\n  },\n\n  _programmaticGrouping() {\n    this._map.eachLayer((layer) => {\n      if (layer instanceof L.DistortableImageOverlay) {\n        layer.deselect();\n      }\n    });\n  },\n\n  setCorner(corner, latlng) {\n    const edit = this.editing;\n\n    this._corners[corner] = latlng;\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  _cornerExceedsMapLats(zoom, corner, map) {\n    if (map.options.crs.Simple == L.CRS.Simple) {\n      return false;\n    } else {\n      let exceedsTop;\n      let exceedsBottom;\n      if (zoom === 0) {\n        exceedsTop = map.project(corner).y < 2;\n        exceedsBottom = map.project(corner).y >= 255;\n      } else {\n        exceedsTop = map.project(corner).y / zoom < 2;\n        exceedsBottom = map.project(corner).y / Math.pow(2, zoom) >= 255;\n      }\n      return (exceedsTop || exceedsBottom);\n    }\n  },\n\n  activateTooltip() {\n    if (!this._selected) {\n      this.bindTooltip(this.tooltipText, {direction: 'top'}).openTooltip();\n    }\n  },\n\n  closeToolTip() {\n    this.closeTooltip();\n  },\n\n  deactivateTooltip() {\n    this.unbindTooltip();\n  },\n\n  getTooltipText() {\n    return this.tooltipText;\n  },\n\n  setCorners(latlngObj) {\n    const map = this._map;\n    const zoom = map.getZoom();\n    const edit = this.editing;\n    let i = 0;\n\n    // this is to fix https://github.com/publiclab/Leaflet.DistortableImage/issues/402\n    for (const k in latlngObj) {\n      if (this._cornerExceedsMapLats(zoom, latlngObj[k], map)) {\n        // calling reset / update w/ the same corners bc it prevents a marker flicker for rotate\n        this.setBounds(L.latLngBounds(this.getCorners()));\n        this.fire('update');\n        return;\n      }\n    }\n\n    for (const k in latlngObj) {\n      this._corners[i] = latlngObj[k];\n      i += 1;\n    }\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  setCornersFromPoints(pointsObj) {\n    const map = this._map;\n    const zoom = map.getZoom();\n    const edit = this.editing;\n    let i = 0;\n\n    for (const k in pointsObj) {\n      const corner = map.layerPointToLatLng(pointsObj[k]);\n\n      if (this._cornerExceedsMapLats(zoom, corner, map)) {\n        // calling reset / update w/ the same corners bc it prevents a marker flicker for rotate\n        this.setBounds(L.latLngBounds(this.getCorners()));\n        this.fire('update');\n        return;\n      }\n    }\n\n    for (const k in pointsObj) {\n      this._corners[i] = map.layerPointToLatLng(pointsObj[k]);\n      i += 1;\n    }\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  scaleBy(scale) {\n    const map = this._map;\n    const center = map.project(this.getCenter());\n    let i;\n    let p;\n    const scaledCorners = {};\n\n    if (scale === 0) { return; }\n\n    for (i = 0; i < 4; i++) {\n      p = map\n          .project(this.getCorner(i))\n          .subtract(center)\n          .multiplyBy(scale)\n          .add(center);\n      scaledCorners[i] = map.unproject(p);\n    }\n\n    this.setCorners(scaledCorners);\n\n    return this;\n  },\n\n  getAngle(unit = 'deg') {\n    const matrix = this.getElement().style[L.DomUtil.TRANSFORM]\n        .split('matrix3d')[1]\n        .slice(1, -1)\n        .split(',');\n\n    const row0x = matrix[0];\n    const row0y = matrix[1];\n    const row1x = matrix[4];\n    const row1y = matrix[5];\n\n    const determinant = row0x * row1y - row0y * row1x;\n\n    let angle = L.TrigUtil.calcAngle(row0x, row0y, 'rad');\n\n    if (determinant < 0) {\n      angle += angle < 0 ? Math.PI : -Math.PI;\n    }\n\n    if (angle < 0) {\n      angle = 2 * Math.PI + angle;\n    }\n\n    return unit === 'deg' ?\n        Math.round(L.TrigUtil.radiansToDegrees(angle)) :\n        L.Util.formatNum(angle, 2);\n  },\n\n  setAngle(angle, unit = 'deg') {\n    const currentAngle = this.getAngle(unit);\n    const angleToRotateBy = angle - currentAngle;\n    this.rotateBy(angleToRotateBy, unit);\n\n    return this;\n  },\n\n  rotateBy(angle, unit = 'deg') {\n    const map = this._map;\n    const center = map.project(this.getCenter());\n    const corners = {};\n    let i;\n    let p;\n    let q;\n\n    if (unit === 'deg') {\n      angle = L.TrigUtil.degreesToRadians(angle);\n    }\n\n    for (i = 0; i < 4; i++) {\n      p = map.project(this.getCorner(i)).subtract(center);\n      q = L.point(\n          Math.cos(angle) * p.x - Math.sin(angle) * p.y,\n          Math.sin(angle) * p.x + Math.cos(angle) * p.y\n      );\n      corners[i] = map.unproject(q.add(center));\n    }\n\n    this.setCorners(corners);\n\n    return this;\n  },\n\n  dragBy(formerPoint, newPoint) {\n    const map = this._map;\n    let i;\n    let p;\n    const transCorners = {};\n    const delta = map.project(formerPoint).subtract(map.project(newPoint));\n\n    for (i = 0; i < 4; i++) {\n      p = map.project(this.getCorner(i)).subtract(delta);\n      transCorners[i] = map.unproject(p);\n    }\n\n    this.setCorners(transCorners);\n  },\n\n  restore() {\n    const map = this._map;\n    const center = this._initialDimensions.center;\n    const offset = this._initialDimensions.offset;\n    const zoom = this._initialDimensions.zoom;\n    const corners = [\n      center.subtract(offset),\n      center.add(L.point(offset.x, -offset.y)),\n      center.add(L.point(-offset.x, offset.y)),\n      center.add(offset),\n    ];\n\n    for (let i = 0; i < 4; i++) {\n      if (!map.unproject(corners[i], zoom).equals(this.getCorner(i))) {\n        this.setCorner(i, map.unproject(corners[i], zoom));\n      }\n    }\n\n    this.edited = false;\n    this.fire('restore');\n\n    return this;\n  },\n\n  /* Copied from Leaflet v0.7 https://github.com/Leaflet/Leaflet/blob/66282f14bcb180ec87d9818d9f3c9f75afd01b30/src/dom/DomUtil.js#L189-L199 */\n  /* since L.DomUtil.getTranslateString() is deprecated in Leaflet v1.0 */\n  _getTranslateString(point) {\n    // on WebKit browsers (Chrome/Safari/iOS Safari/Android)\n    // using translate3d instead of translate\n    // makes animation smoother as it ensures HW accel is used.\n    // Firefox 13 doesn't care\n    // (same speed either way), Opera 12 doesn't support translate3d\n\n    const is3d = L.Browser.webkit3d;\n    const open = 'translate' + (is3d ? '3d' : '') + '(';\n    const close = (is3d ? ',0' : '') + ')';\n\n    return open + point.x + 'px,' + point.y + 'px' + close;\n  },\n\n  _reset() {\n    const map = this._map;\n    const image = this.getElement();\n    const latLngToLayerPoint = L.bind(map.latLngToLayerPoint, map);\n    const transformMatrix = this\n        ._calculateProjectiveTransform(latLngToLayerPoint);\n    const topLeft = latLngToLayerPoint(this.getCorner(0));\n    const warp = L.DomUtil.getMatrixString(transformMatrix);\n    const translation = this._getTranslateString(topLeft);\n\n    /* See L.DomUtil.setPosition. Mainly for the purposes of L.Draggable. */\n    image._leaflet_pos = topLeft;\n\n    image.style[L.DomUtil.TRANSFORM] = [translation, warp].join(' ');\n\n    /* Set origin to the upper-left corner rather than\n     * the center of the image, which is the default.\n     */\n    image.style[L.DomUtil.TRANSFORM + '-origin'] = '0 0 0';\n\n    this.rotation.deg = this.getAngle();\n    this.rotation.rad = this.getAngle('rad');\n  },\n\n  /*\n   * Calculates the transform string that will be\n   * correct *at the end* of zooming.\n   * Leaflet then generates a CSS3 animation between the current transform and\n   * future transform which makes the transition appear smooth.\n   */\n  _animateZoom(event) {\n    const map = this._map;\n    const image = this.getElement();\n    const latLngToNewLayerPoint = function(latlng) {\n      return map._latLngToNewLayerPoint(latlng, event.zoom, event.center);\n    };\n    const transformMatrix = this._calculateProjectiveTransform(\n        latLngToNewLayerPoint\n    );\n    const topLeft = latLngToNewLayerPoint(this.getCorner(0));\n    const warp = L.DomUtil.getMatrixString(transformMatrix);\n    const translation = this._getTranslateString(topLeft);\n\n    /* See L.DomUtil.setPosition. Mainly for the purposes of L.Draggable. */\n    image._leaflet_pos = topLeft;\n\n    image.style[L.DomUtil.TRANSFORM] = [translation, warp].join(' ');\n  },\n\n  getCorners() {\n    return this._corners;\n  },\n\n  getCorner(i) {\n    return this._corners[i];\n  },\n\n  // image (vertex) centroid calculation\n  getCenter() {\n    const map = this._map;\n    const reduce = this.getCorners().reduce(function(agg, corner) {\n      return agg.add(map.project(corner));\n    }, L.point(0, 0));\n    return map.unproject(reduce.divideBy(4));\n  },\n\n  _calculateProjectiveTransform(latLngToCartesian) {\n    /* Setting reasonable but made-up image defaults\n     * allow us to place images on the map before\n     * they've finished downloading. */\n    const offset = latLngToCartesian(this.getCorner(0));\n    const w = this.getElement().offsetWidth || 500;\n    const h = this.getElement().offsetHeight || 375;\n    const c = [];\n    let j;\n    /* Convert corners to container points (i.e. cartesian coordinates). */\n    for (j = 0; j < 4; j++) {\n      c.push(latLngToCartesian(this.getCorner(j))._subtract(offset));\n    }\n\n    /*\n     * This matrix describes the action of\n     * the CSS transform on each corner of the image.\n     * It maps from the coordinate system centered\n     * at the upper left corner of the image\n     * to the region bounded by the latlngs in this._corners.\n     * For example:\n     * 0, 0, c[0].x, c[0].y\n     * says that the upper-left corner of the image\n     * maps to the first latlng in this._corners.\n     */\n    return L.MatrixUtil.general2DProjection(\n        0, 0, c[0].x, c[0].y,\n        w, 0, c[1].x, c[1].y,\n        0, h, c[2].x, c[2].y,\n        w, h, c[3].x, c[3].y\n    );\n  },\n});\n\nL.distortableImageOverlay = function(id, options) {\n  return new L.DistortableImageOverlay(id, options);\n};\n\nL.Map.addInitHook(function() {\n  if (!L.DomUtil.hasClass(this.getContainer(), 'ldi')) {\n    L.DomUtil.addClass(this.getContainer(), 'ldi');\n  }\n});\n","L.RotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'rotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n\n    /*\n     * running rotation logic even for an angle delta of 0\n     * prevents a small, occasional marker flicker\n     */\n    overlay.rotateBy(angle, 'rad');\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.rotateHandle = function(overlay, idx, options) {\n  return new L.RotateHandle(overlay, idx, options);\n};\n","/* eslint-disable no-unused-vars */\nL.EXIF = function getEXIFdata(img) {\n  if (Object.keys(EXIF.getAllTags(img)).length !== 0) {\n    console.log(EXIF.getAllTags(img));\n    const GPS = EXIF.getAllTags(img);\n    let altitude;\n\n    /* If the lat/lng is available. */\n    if (\n      typeof GPS.GPSLatitude !== 'undefined' &&\n      typeof GPS.GPSLongitude !== 'undefined'\n    ) {\n      // sadly, encoded in [degrees,minutes,seconds]\n      // primitive value = GPS.GPSLatitude[x].numerator\n      let lat =\n        GPS.GPSLatitude[0] +\n        GPS.GPSLatitude[1] / 60 +\n        GPS.GPSLatitude[2] / 3600;\n      let lng =\n        GPS.GPSLongitude[0] +\n        GPS.GPSLongitude[1] / 60 +\n        GPS.GPSLongitude[2] / 3600;\n\n      if (GPS.GPSLatitudeRef !== 'N') {\n        lat = lat * -1;\n      }\n      if (GPS.GPSLongitudeRef === 'W') {\n        lng = lng * -1;\n      }\n    }\n\n    // Attempt to use GPS compass heading; will require\n    // some trig to calc corner points, which you can find below:\n\n    let angle = 0;\n    // \"T\" refers to \"True north\", so -90.\n    if (GPS.GPSImgDirectionRef === 'T') {\n      angle =\n        (Math.PI / 180) *\n        (GPS.GPSImgDirection.numerator / GPS.GPSImgDirection.denominator - 90);\n      // \"M\" refers to \"Magnetic north\"\n    } else if (GPS.GPSImgDirectionRef === 'M') {\n      angle =\n        (Math.PI / 180) *\n        (GPS.GPSImgDirection.numerator / GPS.GPSImgDirection.denominator - 90);\n    } else {\n      console.log('No compass data found');\n    }\n\n    console.log('Orientation:', GPS.Orientation);\n\n    /* If there is orientation data -- i.e. landscape/portrait etc */\n    if (GPS.Orientation === 6) {\n      // CCW\n      angle += (Math.PI / 180) * -90;\n    } else if (GPS.Orientation === 8) {\n      // CW\n      angle += (Math.PI / 180) * 90;\n    } else if (GPS.Orientation === 3) {\n      // 180\n      angle += (Math.PI / 180) * 180;\n    }\n\n    /* If there is altitude data */\n    if (\n      typeof GPS.GPSAltitude !== 'undefined' &&\n      typeof GPS.GPSAltitudeRef !== 'undefined'\n    ) {\n      // Attempt to use GPS altitude:\n      // (may eventually need to find EXIF field of view for correction)\n      if (\n        typeof GPS.GPSAltitude !== 'undefined' &&\n        typeof GPS.GPSAltitudeRef !== 'undefined'\n      ) {\n        altitude =\n          GPS.GPSAltitude.numerator / GPS.GPSAltitude.denominator +\n          GPS.GPSAltitudeRef;\n      } else {\n        altitude = 0; // none\n      }\n    }\n  } else {\n    alert('EXIF initialized. Press again to view data in console.');\n  }\n};\n","L.DomUtil = L.extend(L.DomUtil, {\n  initTranslation(obj) {\n    this.translation = obj;\n  },\n\n  getMatrixString(m) {\n    const is3d = L.Browser.webkit3d || L.Browser.gecko3d || L.Browser.ie3d;\n\n    /*\n     * Since matrix3d takes a 4*4 matrix, we add in an empty row and column,\n     * which act as the identity on the z-axis.\n     * See:\n     *     http://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/\n     *     https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function#M.C3.B6bius'_homogeneous_coordinates_in_projective_geometry\n     */\n    const matrix = [\n      m[0], m[3], 0, m[6],\n      m[1], m[4], 0, m[7],\n      0, 0, 1, 0,\n      m[2], m[5], 0, m[8],\n    ];\n\n    const str = is3d ? 'matrix3d(' + matrix.join(',') + ')' : '';\n\n    if (!is3d) {\n      console\n          .log('Your browser must support 3D CSS transforms' +\n          'in order to use DistortableImageOverlay.');\n    }\n\n    return str;\n  },\n\n  toggleClass(el, className) {\n    const c = className;\n    return this.hasClass(el, c) ?\n      this.removeClass(el, c) : this.addClass(el, c);\n  },\n\n  confirmDelete() {\n    return window.confirm(this.translation.confirmImageDelete);\n  },\n\n  confirmDeletes(n) {\n    if (n === 1) { return this.confirmDelete(); }\n\n    const translation = this.translation.confirmImagesDeletes;\n    let warningMsg = '';\n\n    if (typeof translation === 'function') {\n      warningMsg = translation(n);\n    } else {\n      warningMsg = translation;\n    }\n\n    return window.confirm(warningMsg);\n  },\n});\n","L.MatrixUtil = {\n\n  // Compute the adjugate of m\n  adj(m) {\n    return [\n      m[4]*m[8]-m[5]*m[7], m[2]*m[7]-m[1]*m[8], m[1]*m[5]-m[2]*m[4],\n      m[5]*m[6]-m[3]*m[8], m[0]*m[8]-m[2]*m[6], m[2]*m[3]-m[0]*m[5],\n      m[3]*m[7]-m[4]*m[6], m[1]*m[6]-m[0]*m[7], m[0]*m[4]-m[1]*m[3],\n    ];\n  },\n\n  // multiply two 3*3 matrices\n  multmm(a, b) {\n    const c = [];\n    let i;\n\n    for (i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        let cij = 0;\n\n        for (let k = 0; k < 3; k++) {\n          cij += a[3*i + k]*b[3*k + j];\n        }\n\n        c[3*i + j] = cij;\n      }\n    }\n\n    return c;\n  },\n\n  // multiply a 3*3 matrix and a 3-vector\n  multmv(m, v) {\n    return [\n      m[0]*v[0] + m[1]*v[1] + m[2]*v[2],\n      m[3]*v[0] + m[4]*v[1] + m[5]*v[2],\n      m[6]*v[0] + m[7]*v[1] + m[8]*v[2],\n    ];\n  },\n\n  // multiply a scalar and a 3*3 matrix\n  multsm(s, m) {\n    const matrix = [];\n\n    for (let i = 0, l = m.length; i < l; i++) {\n      matrix.push(s*m[i]);\n    }\n\n    return matrix;\n  },\n\n  basisToPoints(x1, y1, x2, y2, x3, y3, x4, y4) {\n    const m = [\n      x1, x2, x3,\n      y1, y2, y3,\n      1, 1, 1,\n    ];\n    const v = L.MatrixUtil.multmv(L.MatrixUtil.adj(m), [x4, y4, 1]);\n\n    return L.MatrixUtil.multmm(m, [\n      v[0], 0, 0,\n      0, v[1], 0,\n      0, 0, v[2],\n    ]);\n  },\n\n  project(m, x, y) {\n    const v = L.MatrixUtil.multmv(m, [x, y, 1]);\n\n    return [v[0]/v[2], v[1]/v[2]];\n  },\n\n  general2DProjection(\n      x1s, y1s, x1d, y1d,\n      x2s, y2s, x2d, y2d,\n      x3s, y3s, x3d, y3d,\n      x4s, y4s, x4d, y4d\n  ) {\n    const s = L.MatrixUtil.basisToPoints(x1s, y1s, x2s, y2s, x3s, y3s, x4s, y4s);\n    const d = L.MatrixUtil.basisToPoints(x1d, y1d, x2d, y2d, x3d, y3d, x4d, y4d);\n    const m = L.MatrixUtil.multmm(d, L.MatrixUtil.adj(s));\n\n    // Normalize to the unique matrix with m[8] == 1.\n    // See: http://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/\n\n    return L.MatrixUtil.multsm(1/m[8], m);\n  },\n};\n","L.DragAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'drag',\n      tooltip: overlay.options.translation.dragImage,\n      className: 'drag',\n    };\n\n    L.DistortableImage.action_map.D = '_dragMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._dragMode();\n  },\n});\n","/* eslint-disable max-len */\nL.ToolbarIconSet = L.IconSet.extend({\n  _symbols:\n    '<symbol viewBox=\"0 0 18 18\" id=\"border_clear\"><path d=\"M5.25 3.75h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm3-3h1.5v-1.5h-1.5v1.5zm0 3h1.5v-1.5h-1.5v1.5zm-6 0h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm6 6h1.5v-1.5h-1.5v1.5zm6 3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm0-9h1.5v-1.5h-1.5v1.5zm-6 0h1.5v-1.5h-1.5v1.5zm6-4.5v1.5h1.5v-1.5h-1.5zm-6 1.5h1.5v-1.5h-1.5v1.5zm3 12h1.5v-1.5h-1.5v1.5zm0-6h1.5v-1.5h-1.5v1.5zm0-6h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"border_outer\"><path d=\"M9.75 5.25h-1.5v1.5h1.5v-1.5zm0 3h-1.5v1.5h1.5v-1.5zm3 0h-1.5v1.5h1.5v-1.5zm-10.5-6v13.5h13.5V2.25H2.25zm12 12H3.75V3.75h10.5v10.5zm-4.5-3h-1.5v1.5h1.5v-1.5zm-3-3h-1.5v1.5h1.5v-1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"cancel\"><path d=\"M13.279 5.779l-1.058-1.058L9 7.942 5.779 4.721 4.721 5.779 7.942 9l-3.221 3.221 1.058 1.058L9 10.057l3.221 3.222 1.058-1.058L10.057 9z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"crop_rotate\"><path d=\"M5.603 16.117C3.15 14.947 1.394 12.57 1.125 9.75H0C.383 14.37 4.245 18 8.963 18c.172 0 .33-.015.495-.023L6.6 15.113l-.997 1.005zM9.037 0c-.172 0-.33.015-.495.03L11.4 2.888l.998-.998a7.876 7.876 0 0 1 4.477 6.36H18C17.617 3.63 13.755 0 9.037 0zM12 10.5h1.5V6A1.5 1.5 0 0 0 12 4.5H7.5V6H12v4.5zM6 12V3H4.5v1.5H3V6h1.5v6A1.5 1.5 0 0 0 6 13.5h6V15h1.5v-1.5H15V12H6z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"delete_forever\"><path d=\"M4.5 14.25c0 .825.675 1.5 1.5 1.5h6c.825 0 1.5-.675 1.5-1.5v-9h-9v9zm1.845-5.34l1.058-1.058L9 9.443l1.59-1.59 1.058 1.058-1.59 1.59 1.59 1.59-1.058 1.058L9 11.558l-1.59 1.59-1.058-1.058 1.59-1.59-1.597-1.59zM11.625 3l-.75-.75h-3.75l-.75.75H3.75v1.5h10.5V3h-2.625z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"distort\"><path d=\"M1.7 1.4H6v1.4h5.8V1.4h4.3v4.3h-1.4v5.8h1.4v4.4h-4.3v-1.5H6v1.5H1.7v-4.4h1.4V5.7H1.7V1.4zm10.1 4.3V4.3H6v1.4H4.6v5.8H6V13h5.8v-1.5h1.4V5.7h-1.4zM3.1 2.8v1.5h1.5V2.8H3.1zm10.1 0v1.5h1.5V2.8h-1.5zM3.1 13v1.4h1.5V13H3.1zm10.1 0v1.4h1.5V13h-1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"explore\"><path d=\"M9 1.5C4.86 1.5 1.5 4.86 1.5 9c0 4.14 3.36 7.5 7.5 7.5 4.14 0 7.5-3.36 7.5-7.5 0-4.14-3.36-7.5-7.5-7.5zM9 15c-3.308 0-6-2.693-6-6 0-3.308 2.692-6 6-6 3.307 0 6 2.692 6 6 0 3.307-2.693 6-6 6zm-4.125-1.875l5.633-2.617 2.617-5.633-5.633 2.617-2.617 5.633zM9 8.175c.457 0 .825.367.825.825A.823.823 0 0 1 9 9.825.823.823 0 0 1 8.175 9c0-.457.367-.825.825-.825z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"flip_to_back\"><path d=\"M6.75 5.25h-1.5v1.5h1.5v-1.5zm0 3h-1.5v1.5h1.5v-1.5zm0-6a1.5 1.5 0 0 0-1.5 1.5h1.5v-1.5zm3 9h-1.5v1.5h1.5v-1.5zm4.5-9v1.5h1.5c0-.825-.675-1.5-1.5-1.5zm-4.5 0h-1.5v1.5h1.5v-1.5zm-3 10.5v-1.5h-1.5a1.5 1.5 0 0 0 1.5 1.5zm7.5-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0 6c.825 0 1.5-.675 1.5-1.5h-1.5v1.5zm-10.5-7.5h-1.5v9a1.5 1.5 0 0 0 1.5 1.5h9v-1.5h-9v-9zm7.5-1.5h1.5v-1.5h-1.5v1.5zm0 9h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"flip_to_front\"><path d=\"M2.25 9.75h1.5v-1.5h-1.5v1.5zm0 3h1.5v-1.5h-1.5v1.5zm1.5 3v-1.5h-1.5a1.5 1.5 0 0 0 1.5 1.5zm-1.5-9h1.5v-1.5h-1.5v1.5zm9 9h1.5v-1.5h-1.5v1.5zm3-13.5h-7.5a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h7.5c.825 0 1.5-.675 1.5-1.5v-7.5c0-.825-.675-1.5-1.5-1.5zm0 9h-7.5v-7.5h7.5v7.5zm-6 4.5h1.5v-1.5h-1.5v1.5zm-3 0h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"get_app\"><path d=\"M14.662 6.95h-3.15v-4.5H6.787v4.5h-3.15L9.15 12.2l5.512-5.25zM3.637 13.7v1.5h11.025v-1.5H3.637z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"lock\"><path d=\"M13.5 6h-.75V4.5C12.75 2.43 11.07.75 9 .75 6.93.75 5.25 2.43 5.25 4.5V6H4.5C3.675 6 3 6.675 3 7.5V15c0 .825.675 1.5 1.5 1.5h9c.825 0 1.5-.675 1.5-1.5V7.5c0-.825-.675-1.5-1.5-1.5zM6.75 4.5A2.247 2.247 0 0 1 9 2.25a2.247 2.247 0 0 1 2.25 2.25V6h-4.5V4.5zM13.5 15h-9V7.5h9V15zM9 12.75c.825 0 1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5-1.5.675-1.5 1.5.675 1.5 1.5 1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"opacity\"><path d=\"M13.245 6L9 1.763 4.755 6A6.015 6.015 0 0 0 3 10.23c0 1.5.585 3.082 1.755 4.252a5.993 5.993 0 0 0 8.49 0A6.066 6.066 0 0 0 15 10.23c0-1.5-.585-3.06-1.755-4.23zM4.5 10.5c.008-1.5.465-2.453 1.32-3.3L9 3.952l3.18 3.285c.855.84 1.313 1.763 1.32 3.263h-9z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 14 18\" id=\"opacity_empty\"><path stroke=\"#0078A8\" stroke-width=\"1.7\" d=\"M10.708 6.25A5.113 5.113 0 0 1 12.2 9.846c0 1.275-.497 2.62-1.492 3.614a5.094 5.094 0 0 1-7.216 0A5.156 5.156 0 0 1 2 9.846c0-1.275.497-2.601 1.492-3.596L7.1 2.648l3.608 3.602zm0 0L7.1 2.648 3.492 6.25A5.113 5.113 0 0 0 2 9.846c0 1.275.497 2.62 1.492 3.614a5.094 5.094 0 0 0 7.216 0A5.156 5.156 0 0 0 12.2 9.846a5.113 5.113 0 0 0-1.492-3.596z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 14 18\" id=\"opacities\"><g fill=\"#0078a8\"><path d=\"m2.1 10.85c.2.98.68 1.89 1.39 2.61 0 0 .01.01.01.01.99.99 2.3 1.49 3.6 1.49h.01c1.3 0 2.6-.5 3.59-1.5.73-.73 1.19-1.66 1.39-2.61z\" opacity=\".75\"/><path d=\"m2 9.85c0 .34.04.68.1 1.01h9.99c.07-.34.11-.67.11-1.01 0-1.13-.4-2.21-1.08-3.09h-8.04c-.7.91-1.08 2.01-1.08 3.09z\" opacity=\".5\"/><path d=\"m3.08 6.75h8.03c-.13-.17-.26-.35-.41-.5l-3.6-3.6-3.61 3.6c-.15.16-.27.33-.41.5z\" opacity=\".25\"/></g><path d=\"m10.71 6.25c.95.96 1.49 2.25 1.49 3.6 0 1.27-.5 2.62-1.49 3.61-1.99 1.99-5.21 2-7.2.01 0 0-.01-.01-.01-.01-.96-.96-1.5-2.26-1.5-3.61 0-1.27.5-2.6 1.49-3.6l3.61-3.6z\" fill=\"none\" stroke=\"#0078a8\" stroke-width=\".1\"/><path d=\"m10.71 6.25c.95.96 1.49 2.25 1.49 3.6 0 1.27-.5 2.62-1.49 3.61-1.99 1.99-5.21 2-7.2.01 0 0-.01-.01-.01-.01-.96-.96-1.5-2.26-1.5-3.61 0-1.27.5-2.6 1.49-3.6l3.61-3.6z\" fill=\"none\" stroke=\"#0078a8\" stroke-width=\"1.7\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"restore\"><path d=\"M15.67 3.839a.295.295 0 0 0-.22.103l-5.116 3.249V4.179a.342.342 0 0 0-.193-.315.29.29 0 0 0-.338.078L3.806 7.751v-4.63h-.002l.002-.022c0-.277-.204-.502-.456-.502h-.873V2.6c-.253 0-.457.225-.457.503l.002.026v10.883h.005c.021.257.217.454.452.455l.016-.002h.822c.013.001.025.004.038.004.252 0 .457-.225.457-.502a.505.505 0 0 0-.006-.068V9.318l6.001 3.811a.288.288 0 0 0 .332.074.34.34 0 0 0 .194-.306V9.878l5.12 3.252a.288.288 0 0 0 .332.073.34.34 0 0 0 .194-.306V4.18a.358.358 0 0 0-.09-.24.296.296 0 0 0-.218-.1z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"rotate\"><path d=\"M5.505 4.808L.645 9.675l4.867 4.86 4.868-4.86-4.875-4.868zM2.768 9.675L5.513 6.93 8.25 9.675 5.505 12.42 2.768 9.675zM14.52 4.98A6.713 6.713 0 009.75 3V.57L6.57 3.75l3.18 3.18V4.5a5.23 5.23 0 013.713 1.537 5.255 5.255 0 010 7.426 5.23 5.23 0 01-5.843 1.08L6.503 15.66a6.76 6.76 0 003.247.84c1.725 0 3.457-.66 4.77-1.98a6.735 6.735 0 000-9.54z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"scale\"><path d=\"M8.25 9h-6a.75.75 0 00-.75.75v6c0 .414.336.75.75.75h6a.75.75 0 00.75-.75v-6A.75.75 0 008.25 9zm-.75 6H3v-4.5h4.5V15zm8.94-13.035a.75.75 0 00-.405-.405.75.75 0 00-.285-.06h-4.5a.75.75 0 000 1.5h2.692L9.967 6.968a.75.75 0 000 1.064.75.75 0 001.065 0L15 4.057V6.75a.75.75 0 101.5 0v-4.5a.75.75 0 00-.06-.285z\" /></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"spinner\"><path d=\"M9 6.48c-.216 0-.36-.144-.36-.36V3.24c0-.216.144-.36.36-.36s.36.144.36.36v2.88c0 .216-.144.36-.36.36z\"/><path d=\"M9 15.12c-.216 0-.36-.144-.36-.36v-2.88c0-.216.144-.36.36-.36s.36.144.36.36v2.88c0 .216-.144.36-.36.36zm1.44-8.28c-.072 0-.108 0-.18-.036-.144-.108-.216-.288-.108-.468l1.44-2.484c.108-.144.288-.216.468-.108.144.108.216.288.108.468l-1.44 2.484c-.072.072-.18.144-.288.144zm-4.32 7.488c-.072 0-.108 0-.18-.036-.144-.108-.216-.288-.108-.468l1.44-2.484c.108-.144.288-.216.468-.108.144.108.216.288.108.468l-1.44 2.484c-.072.072-.18.144-.288.144z\" opacity=\".3\"/><path d=\"M7.56 6.84c-.108 0-.216-.072-.288-.18l-1.44-2.484c-.108-.144-.036-.36.108-.468.144-.108.36-.036.468.108L7.848 6.3c.108.144.036.36-.108.468-.072.072-.108.072-.18.072z\" opacity=\".93\"/><path d=\"M11.88 14.328c-.108 0-.216-.072-.288-.18l-1.44-2.484c-.108-.144-.036-.36.108-.468.144-.108.36-.036.468.108l1.44 2.484c.108.144.036.36-.108.468-.072.036-.108.072-.18.072z\" opacity=\".3\"/><path d=\"M6.12 9.36H3.24c-.216 0-.36-.144-.36-.36s.144-.36.36-.36h2.88c.216 0 .36.144.36.36s-.144.36-.36.36z\" opacity=\".65\"/><path d=\"M14.76 9.36h-2.88c-.216 0-.36-.144-.36-.36s.144-.36.36-.36h2.88c.216 0 .36.144.36.36s-.144.36-.36.36z\" opacity=\".3\"/><path d=\"M6.516 7.884c-.072 0-.108 0-.18-.036l-2.484-1.44c-.144-.108-.216-.288-.108-.468.108-.144.288-.216.468-.108l2.484 1.44c.144.108.216.288.108.468a.327.327 0 01-.288.144z\" opacity=\".86\"/><path d=\"M14.004 12.204c-.072 0-.108 0-.18-.036l-2.484-1.44c-.144-.108-.216-.288-.108-.468.108-.144.288-.216.468-.108l2.484 1.44c.144.108.216.288.108.468a.327.327 0 01-.288.144z\" opacity=\".3\"/><path d=\"M3.996 12.204c-.108 0-.216-.072-.288-.18-.108-.144-.036-.36.108-.468l2.484-1.44c.144-.108.36-.036.468.108.108.144.036.36-.108.468l-2.484 1.44c-.036.072-.108.072-.18.072z\" opacity=\".44\"/><path d=\"M11.484 7.884c-.108 0-.216-.072-.288-.18-.108-.144-.036-.36.108-.468l2.484-1.44c.144-.108.36-.036.468.108.108.144.036.36-.108.468l-2.484 1.44c-.072.072-.108.072-.18.072z\" opacity=\".3\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"drag\"><path d=\"M2.3 16.5c-0.2 0-0.4-0.1-0.5-0.2 -0.2-0.2-0.3-0.5-0.2-0.8l2.5-6.5 -2.5-6.5C1.5 2.3 1.5 2 1.7 1.8c0.2-0.2 0.5-0.3 0.8-0.2l6.5 2.5 6.5-2.5c0.3-0.1 0.6 0 0.8 0.2 0.2 0.2 0.3 0.5 0.2 0.8l-2.5 6.5 2.5 6.5c0.1 0.3 0 0.6-0.2 0.8 -0.2 0.2-0.5 0.3-0.8 0.2l-6.5-2.5 -6.5 2.5C2.4 16.5 2.3 16.5 2.3 16.5zM3.6 3.6l2 5.1c0.1 0.2 0.1 0.4 0 0.5l-2 5.1 5.1-2c0.2-0.1 0.4-0.1 0.5 0l5.1 2L12.4 9.3c-0.1-0.2-0.1-0.4 0-0.5l2-5.1L9.3 5.6c-0.2 0.1-0.4 0.1-0.5 0L3.6 3.6z\" /></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"unlock\"><path d=\"M13.5 6h-.75V4.5C12.75 2.43 11.07.75 9 .75 6.93.75 5.25 2.43 5.25 4.5h1.5A2.247 2.247 0 0 1 9 2.25a2.247 2.247 0 0 1 2.25 2.25V6H4.5C3.675 6 3 6.675 3 7.5V15c0 .825.675 1.5 1.5 1.5h9c.825 0 1.5-.675 1.5-1.5V7.5c0-.825-.675-1.5-1.5-1.5zm0 9h-9V7.5h9V15zM9 12.75c.825 0 1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5-1.5.675-1.5 1.5.675 1.5 1.5 1.5z\"/></symbol>',\n});\n","L.RotateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'rotate',\n      tooltip: overlay.options.translation.rotateImage,\n      className: 'rotate',\n    };\n\n    L.DistortableImage.action_map.r = '_rotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._rotateMode();\n  },\n});\n","/* eslint-disable max-len */\nL.Map.include({\n\n  _clicked: 0,\n\n  addGoogleMutant(opts) {\n    const url = 'http://mt0.google.com/vt/lyrs=s&x={x}&y={y}&z={z}';\n\n    opts = this.mutantOptions = L.extend({\n      mutantOpacity: 0.8,\n      maxZoom: 24,\n      maxNativeZoom: 20,\n      minZoom: 0,\n      labels: true,\n      labelOpacity: 1,\n      doubleClickLabels: true,\n    }, opts);\n\n    if (!opts.labels) {\n      this.mutantOptions = L.extend(this.mutantOptions, {\n        labelOpacity: opts.labels ? 1 : undefined,\n        doubleClickLabels: opts.labels ? true : undefined,\n      });\n    }\n\n    this._googleMutant = L.tileLayer(url, {\n      maxZoom: opts.maxZoom,\n      maxNativeZoom: opts.maxNativeZoom,\n      minZoom: opts.minZoom,\n      opacity: opts.mutantOpacity,\n    }).addTo(this);\n\n    if (opts.labels) { this._addLabels(opts); }\n    // shouldn't have this handler at all if there are no labels to toggle\n    else {\n      this.doubleClickLabels = undefined;\n    }\n\n    return this;\n  },\n\n  _addLabels(opts) {\n    const url = 'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}{r}.{ext}';\n\n    if (opts.labelOpacity !== 0 && opts.labelOpacity !== 1) {\n      opts.labelOpacity = 1;\n    }\n\n    this._labels = L.tileLayer(url, {\n      attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n      subdomains: 'abcd',\n      interactive: false,\n      opacity: opts.labelOpacity,\n      maxZoom: opts.maxZoom,\n      maxNativeZoom: opts.maxNativeZoom,\n      minZoom: opts.minZoom,\n      ext: 'png',\n    }).addTo(this);\n\n    if (this.mutantOptions.doubleClickLabels) {\n      this.doubleClickLabels.enable();\n    }\n\n    return this;\n  },\n});\n// start off with doubleClickZoom enabled, doubleClickLabels can later be enabled instead\n// during initialization\nL.Map.addInitHook(function() {\n  this.doubleClickLabels.disable();\n  this.doubleClickZoom.enable();\n});\n","L.LockAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    let use;\n    let tooltip;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      L.DistortableImage.action_map.u = '_unlock';\n      L.DistortableImage.action_map.l = '_lock';\n      tooltip = overlay.options.translation.lockMode;\n\n      use = edit.isMode('lock') ? 'lock' : 'unlock';\n    } else {\n      L.DistortableImage.group_action_map.l = '_lockGroup';\n      tooltip = overlay.options.translation.lockImages;\n      use = 'lock';\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: 'lock',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) { edit._toggleLockMode(); }\n    else { edit._lockGroup(); }\n  },\n});\n","L.ImageUtil = {\n\n  getCmPerPixel(overlay) {\n    const map = overlay._map;\n\n    const dist = map\n        .latLngToLayerPoint(overlay.getCorner(0))\n        .distanceTo(map.latLngToLayerPoint(overlay.getCorner(1)));\n\n    return (dist * 100) / overlay.getElement().width;\n  },\n};\n","L.EditHandle = L.Marker.extend({\n  initialize(overlay, corner, options) {\n    const latlng = overlay.getCorner(corner);\n\n    L.setOptions(this, options);\n\n    this._handled = overlay;\n    this._corner = corner;\n\n    const markerOptions = {\n      draggable: true,\n      zIndexOffset: 10,\n    };\n\n    if (options && options.hasOwnProperty('draggable')) {\n      markerOptions.draggable = options.draggable;\n    }\n\n    L.Marker.prototype.initialize.call(this, latlng, markerOptions);\n  },\n\n  onAdd(map) {\n    L.Marker.prototype.onAdd.call(this, map);\n    this._bindListeners();\n    this.updateHandle();\n  },\n\n  onRemove(map) {\n    this._unbindListeners();\n    L.Marker.prototype.onRemove.call(this, map);\n  },\n\n  _onHandleDragStart() {\n    this._handled.fire('editstart');\n  },\n\n  _onHandleDragEnd() {\n    this._fireEdit();\n  },\n\n  _fireEdit() {\n    this._handled.edited = true;\n    this._handled.fire('edit');\n  },\n\n  _bindListeners() {\n    this.on({\n      contextmenu: L.DomEvent.stop,\n      dragstart: this._onHandleDragStart,\n      drag: this._onHandleDrag,\n      dragend: this._onHandleDragEnd,\n    }, this);\n\n    this._handled._map.on('zoomend', this.updateHandle, this);\n    this._handled.on('update', this.updateHandle, this);\n  },\n\n  _unbindListeners() {\n    this.off({\n      contextmenu: L.DomEvent.stop,\n      dragstart: this._onHandleDragStart,\n      drag: this._onHandleDrag,\n      dragend: this._onHandleDragEnd,\n    }, this);\n\n    this._handled._map.off('zoomend', this.updateHandle, this);\n    this._handled.off('update', this.updateHandle, this);\n  },\n\n  /* Takes two latlngs and calculates the scaling difference. */\n  _calculateScalingFactor(latlngA, latlngB) {\n    const overlay = this._handled;\n    const map = overlay._map;\n\n    const centerPoint = map.latLngToLayerPoint(overlay.getCenter());\n    const formerPoint = map.latLngToLayerPoint(latlngA);\n    const newPoint = map.latLngToLayerPoint(latlngB);\n    const formerRadiusSquared = this._d2(centerPoint, formerPoint);\n    const newRadiusSquared = this._d2(centerPoint, newPoint);\n\n    return Math.sqrt(newRadiusSquared / formerRadiusSquared);\n  },\n\n  /* Distance between two points in cartesian space, squared (distance formula). */\n  _d2(a, b) {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n\n    return Math.pow(dx, 2) + Math.pow(dy, 2);\n  },\n\n  /* Takes two latlngs and calculates the angle between them. */\n  calculateAngleDelta(latlngA, latlngB) {\n    const overlay = this._handled;\n    const map = overlay._map;\n\n\n    const centerPoint = map.latLngToLayerPoint(overlay.getCenter());\n    const formerPoint = map.latLngToLayerPoint(latlngA);\n    const newPoint = map.latLngToLayerPoint(latlngB);\n\n    const initialAngle = (\n      Math.atan2(centerPoint.y - formerPoint.y, centerPoint.x - formerPoint.x)\n    );\n    const newAngle = (\n      Math.atan2(centerPoint.y - newPoint.y, centerPoint.x - newPoint.x)\n    );\n\n    return newAngle - initialAngle;\n  },\n});\n","L.RestoreAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const mode = L.Utils.getNestedVal(overlay, 'editing', '_mode');\n    const edited = overlay.edited;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'restore',\n      tooltip: overlay.options.translation.restoreImage,\n      className: edited && mode !== 'lock' ? '' : 'disabled',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const ov = this._overlay;\n\n    L.DomEvent.on(ov, {\n      edit: this._enableAction,\n      restore: this._disableAction,\n    }, this);\n\n    ov.restore();\n  },\n});\n","L.StackAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    let use;\n    let tooltip;\n\n    if (edit._toggledImage) {\n      use = 'flip_to_back';\n      tooltip = overlay.options.translation.stackToFront;\n    } else {\n      use = 'flip_to_front';\n      tooltip = overlay.options.translation.stackToBack;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.DistortableImage.action_map.q = edit._mode === 'lock' ? '' : '_stackUp';\n    L.DistortableImage.action_map.a = edit._mode === 'lock' ? '' : '_stackDown';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    L.IconUtil.toggleXlink(this._link, 'flip_to_front', 'flip_to_back');\n    L.IconUtil.toggleTitle(this._link, 'Stack to Front', 'Stack to Back');\n    edit._toggleOrder();\n  },\n});\n","L.DistortableImage = L.DistortableImage || {};\n\n// this class holds the keybindings and toolbar API for an image collection instance\nL.DistortableCollection.Edit = L.Handler.extend({\n  options: {\n    keymap: L.distortableImage.group_action_map,\n  },\n\n  initialize(group, options) {\n    this._group = group;\n    this._exportOpts = group.options.exportOpts;\n\n    L.setOptions(this, options);\n\n    L.distortableImage.group_action_map.Escape = '_decollectAll';\n  },\n\n  addHooks() {\n    const group = this._group;\n    const map = group._map;\n\n    this.editActions = this.options.actions;\n    this.runExporter =\n        L.bind(L.Utils.getNestedVal(this, '_exportOpts', 'exporter') ||\n        this.startExport, this);\n\n    L.DomEvent.on(document, 'keydown', this._onKeyDown, this);\n\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.on(map, 'click', this._decollectAll, this);\n    }\n\n    L.DomEvent.on(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n      boxcollectend: this._addCollections,\n    }, this);\n\n    this._group.editable = true;\n    this._group.eachLayer(layer => layer.editing.enable());\n  },\n\n  removeHooks() {\n    const group = this._group;\n    const map = group._map;\n\n    L.DomEvent.off(document, 'keydown', this._onKeyDown, this);\n\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.off(map, 'click', this._decollectAll, this);\n    }\n\n    L.DomEvent.off(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n      boxcollectend: this._addCollections,\n    }, this);\n\n    this._decollectAll();\n    this._group.editable = false;\n    this._group.eachLayer(layer => layer.editing.disable());\n  },\n\n  enable() {\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _onKeyDown(e) {\n    const keymap = this.options.keymap;\n    const handlerName = keymap[e.key];\n\n    if (!this[handlerName]) { return; }\n\n    if (this._group.anyCollected()) {\n      this[handlerName].call(this);\n    }\n  },\n\n  _singleClick(e) {\n    if (e.type === 'singleclick') { this._decollectAll(e); }\n    else { return; }\n  },\n\n  _singleClickListeners() {\n    const map = this._group._map;\n    L.DomEvent.off(map, 'click', this._decollectAll, this);\n    L.DomEvent.on(map, 'singleclick', this._decollectAll, this);\n  },\n\n  _resetClickListeners() {\n    const map = this._group._map;\n    L.DomEvent.on(map, 'click', this._decollectAll, this);\n    L.DomEvent.off(map, 'singleclick', this._decollectAll, this);\n  },\n\n  _decollectAll(e) {\n    let oe;\n\n    if (e) { oe = e.originalEvent; }\n    /**\n     * prevents image deselection following the 'boxcollectend' event - note 'shift' must not be released until dragging is complete\n     * also prevents deselection following a click on a disabled img by differentiating it from the map\n     */\n    if (oe && (oe.shiftKey || oe.target instanceof HTMLImageElement)) {\n      return;\n    }\n\n    this._group.eachLayer((layer) => {\n      L.DomUtil.removeClass(layer.getElement(), 'collected');\n      layer.deselect();\n    });\n\n    this._removeToolbar();\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  _unlockGroup() {\n    if (!this.hasTool(L.UnlockAction)) { return; }\n\n    this._group.eachLayer((layer) => {\n      if (this._group.isCollected(layer)) {\n        const edit = layer.editing;\n        edit._unlock();\n        // unlock updates the layer's handles; deselect to ensure they're hidden\n        layer.deselect();\n      }\n    });\n  },\n\n  _lockGroup() {\n    if (!this.hasTool(L.LockAction)) { return; }\n\n    this._group.eachLayer((layer) => {\n      if (this._group.isCollected(layer) ) {\n        const edit = layer.editing;\n        edit._lock();\n        // map.addLayer also deselects the image, so we reselect here\n        L.DomUtil.addClass(layer.getElement(), 'collected');\n      }\n    });\n  },\n\n  _addCollections(e) {\n    const box = e.boxCollectBounds;\n    const map = this._group._map;\n\n    this._group.eachLayer((layer) => {\n      const edit = layer.editing;\n\n      if (layer.isSelected()) { layer.deselect(); }\n\n      const zoom = map.getZoom();\n      const center = map.getCenter();\n      let imgBounds = L.latLngBounds(layer.getCorner(2), layer.getCorner(1));\n\n      imgBounds = map._latLngBoundsToNewLayerBounds(imgBounds, zoom, center);\n      if (box.intersects(imgBounds) && edit.enabled()) {\n        if (!this.toolbar) { this._addToolbar(); }\n        L.DomUtil.addClass(layer.getElement(), 'collected');\n      }\n    });\n  },\n\n  _removeGroup(e) {\n    if (!this.hasTool(L.DeleteAction)) { return; }\n\n    const layersToRemove = this._group._toRemove();\n    const n = layersToRemove.length;\n\n    if (n === 0) { return; }\n\n    const choice = L.DomUtil.confirmDeletes(n);\n\n    if (choice) {\n      layersToRemove.forEach((layer) => {\n        this._group.removeLayer(layer);\n      });\n      if (!this._group.anyCollected()) {\n        this._removeToolbar();\n      }\n    }\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  cancelExport() {\n    if (!this.customCollection) {\n      this._exportOpts.collection = undefined;\n    }\n\n    clearInterval(this.updateInterval);\n  },\n\n  _addToolbar() {\n    const group = this._group;\n    const map = group._map;\n\n    if (group.options.suppressToolbar || this.toolbar) { return; }\n    this.toolbar = L.distortableImage.controlBar({\n      actions: this.editActions,\n      position: 'topleft',\n    }).addTo(map, group);\n  },\n\n  _removeToolbar() {\n    const map = this._group._map;\n    if (this.toolbar) {\n      map.removeLayer(this.toolbar);\n      this.toolbar = false;\n    } else {\n      return false;\n    }\n  },\n\n  hasTool(value) {\n    return this.editActions.some(action => action === value);\n  },\n\n  addTool(value) {\n    if (value.baseClass === 'leaflet-toolbar-icon' && !this.hasTool(value)) {\n      this._removeToolbar();\n      this.editActions.push(value);\n      this._addToolbar();\n    }\n    return this;\n  },\n\n  removeTool(value) {\n    this.editActions.some((item, idx) => {\n      if (this.editActions[idx] === value) {\n        this._removeToolbar();\n        this.editActions.splice(idx, 1);\n        this._addToolbar();\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return this;\n  },\n\n  startExport() {\n    if (!this.hasTool(L.ExportAction)) { return; }\n\n    return new Promise((resolve) => {\n      const opts = this._exportOpts;\n      opts.resolve = resolve; // allow resolving promise in user-defined functions, to stop spinner on completion\n\n      let statusUrl;\n      this.updateInterval = null;\n\n      // this may be overridden to update the UI to show export progress or completion\n      const _defaultUpdater = (data) => {\n        data = JSON.parse(data);\n        // optimization: fetch status directly from google storage:\n        if (data.status_url) {\n          if (statusUrl !== data.status_url && data.status_url.match('.json')) {\n            // if (data.status_url && data.status_url.substr(0,1) === \"/\") {\n            //   opts.statusUrl = opts.statusUrl + data.status_url;\n            // } else {\n            statusUrl = data.status_url;\n            // }\n          }\n\n          if (data.status === 'complete') {\n            clearInterval(this.updateInterval);\n\n            if (!this.customCollection) {\n              this._exportOpts.collection = undefined;\n            }\n\n            resolve();\n            if (data.jpg !== null) {\n              alert('Export succeeded. ' + opts.exportUrl + data.jpg);\n            }\n          }\n\n          // TODO: update to clearInterval when status == \"failed\" if we update that in this file:\n          // https://github.com/publiclab/mapknitter-exporter/blob/main/lib/mapknitterExporter.rb\n          console.log(data);\n        }\n      };\n\n      // receives the URL of status.json, and starts running the updater to repeatedly fetch from status.json;\n      // this may be overridden to integrate with any UI\n      const _defaultHandleStatusRes = (data) => {\n        statusUrl = opts.statusUrl + data;\n        // repeatedly fetch the status.json\n        this.updateInterval = setInterval(() => {\n          const reqOpts = {method: 'GET'};\n          const req = new Request(`${statusUrl}?${Date.now()}`, reqOpts);\n          fetch(req).then((res) => {\n            if (res.ok) {\n              return res.text();\n            }\n          }).then(opts.updater);\n        }, opts.frequency);\n      };\n\n      // initiate the export\n      const _defaultFetchStatusUrl = (mergedOpts) => {\n        const form = new FormData();\n        form.append('collection', JSON.stringify(mergedOpts.collection));\n        form.append('scale', mergedOpts.scale);\n        form.append('upload', true);\n\n        const reqOpts = {method: 'POST', body: form};\n        const req = new Request(mergedOpts.exportStartUrl, reqOpts);\n        fetch(req).then((res) => {\n          if (res.ok) {\n            return res.text();\n          }\n        }).then(mergedOpts.handleStatusRes);\n      };\n\n      // If the user has passed collection property\n      this.customCollection = !!opts.collection;\n      if (!this.customCollection) {\n        opts.collection = this._group.generateExportJson().images;\n      }\n\n      opts.frequency = opts.frequency || 3000;\n      opts.scale = opts.scale || 100; // switch it to _getAvgCmPerPixel !\n      opts.updater = opts.updater || _defaultUpdater;\n      opts.handleStatusRes = opts.handleStatusRes || _defaultHandleStatusRes;\n      opts.fetchStatusUrl = opts.fetchStatusUrl || _defaultFetchStatusUrl;\n\n      opts.fetchStatusUrl(opts);\n    });\n  },\n});\n\nL.distortableCollection.edit = (group, options) => {\n  return new L.DistortableCollection.Edit(group, options);\n};\n","L.UnlockAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'unlock',\n      tooltip: overlay.options.translation.unlockImages,\n    };\n\n    L.DistortableImage.group_action_map.u = '_unlockGroup';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._unlockGroup();\n  },\n});\n","/**\n * `L.Map.DoubleClickZoom` from leaflet 1.5.1, overrwritten so that it\n * 1) Fires a `singleclick` event to avoid deselecting images on `dblclick`.\n * 2) Maintains a mutually exclusive relationship with the map's `DoubleClickLabels` handler\n */\nL.Map.DoubleClickZoom.include({\n  addHooks() {\n    this._map.on({\n      click: this._fireIfSingle,\n      dblclick: this._onDoubleClick,\n    }, this);\n  },\n\n  removeHooks() {\n    this._map.off({\n      click: this._fireIfSingle,\n      dblclick: this._onDoubleClick,\n    }, this);\n  },\n\n  enable() {\n    if (this._enabled) { return this; }\n\n    // don't enable 'doubleClickZoom' unless 'doubleClickLabels' is disabled first\n    if (this._map.doubleClickLabels) {\n      if (this._map.doubleClickLabels.enabled()) {\n        return this;\n      }\n    }\n\n    // signify to collection/instance classes to turn on 'singleclick' listeners\n    this._map.fire('singleclickon');\n\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    // signify to collection/instance safe to swap 'singleclick' listeners with 'click' listeners.\n    this._map.fire('singleclickoff');\n\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _fireIfSingle(e) {\n    const map = this._map;\n    const oe = e.originalEvent;\n\n    // prevents deselection in case of box selector\n    if (oe && oe.shiftKey) { return; }\n\n    map._clicked += 1;\n    this._map._clickTimeout = setTimeout(function() {\n      if (map._clicked === 1) {\n        map._clicked = 0;\n        map.fire('singleclick', {type: 'singleclick'});\n      } else {\n        // manually fire doubleclick event only for touch screens that don't natively fire it\n        if (L.Browser.touch && (oe && oe.sourceCapabilities.firesTouchEvents)) {\n          /*  in `DoubleClickLabels.js`, we just do map.fire('dblclick') bc `_onDoublClick` doesn't use the\n          passed \"e\" (for now). To generate a 'real' DOM event that will have all of its corresponding core\n          properties (originalEvent, latlng, etc.), use Leaflet's `#map._fireDOMEvent` (Leaflet 1.5.1 source) */\n          map._fireDOMEvent(oe, 'dblclick', [map]);\n        }\n      }\n    }, 250);\n  },\n\n  _onDoubleClick(e) {\n    const map = this._map;\n    const oe = e.originalEvent;\n\n    setTimeout(function() {\n      map._clicked = 0;\n      clearTimeout(map._clickTimeout);\n    }, 0);\n\n    if (!oe) { return false; }\n\n    const oldZoom = map.getZoom();\n    const delta = map.options.zoomDelta;\n    const zoom = oe.shiftKey ? oldZoom - delta : oldZoom + delta;\n\n    if (map.options.doubleClickZoom === 'center') {\n      map.setZoom(zoom);\n    } else {\n      map.setZoomAround(e.containerPoint, zoom);\n    }\n  },\n});\n","let opacities = [100, 80, 60, 40, 20, 0]; // Set numeric values from 0 to 100.\n\n// Add custom CSS scripts and overwrites. Pending for better implementation of CSSStyleSheet in browsers.\nconst subtoolbarCss = new CSSStyleSheet();\nsubtoolbarCss.replaceSync(\n    `.leaflet-toolbar-icon-vertical {\n        box-sizing: border-box !important;\n        display: block !important;\n        width: 30px !important;\n        height: 30px !important;\n        line-height: 30px !important;\n        padding: 0 !important;\n        text-align: center !important;\n        text-decoration: none !important;\n        background-color: #fff;\n        border: inset 0.5px lightgray !important;\n        font-size: 12px !important;\n        font-weight: bold !important;\n        color:#0087A8 !important;\n        float: none !important;\n        margin: auto !important;\n        z-index:900 !important;\n      }\n    `\n);\n\nsubtoolbarCss.insertRule(\n    `.leaflet-toolbar-1 li:first-child a {\n        border-radius: 4px 4px 0px 0px !important;\n    }`\n);\ndocument.adoptedStyleSheets = [subtoolbarCss];\n\nopacities = opacities.map((o) => {\n  (isNaN(o) || o > 100) ? o = 100 : o;\n  (o < 0) ? o = 0 : o;\n\n  return L.EditAction.extend({\n    options: {\n      toolbarIcon: {\n        html: o,\n        tooltip: 'Opacity ' + o +'%',\n        className: 'leaflet-toolbar-icon-vertical',\n        style: 'background-color:rgb(' + (100 - o) + '%,' + (100 - o) + '%,' + (100 - o) + '%);',\n      },\n    },\n    addHooks() {\n      this._overlay.editing._setOpacities(o/100);\n    },\n  });\n});\n\nL.OpacitiesToolbar2 = L.Toolbar2.extend({\n  options: {\n    className: '',\n    filter: function() { return true; },\n    actions: [],\n    style: `translate(-1px, -${ ((opacities.length + 1) * 30)}px)`,\n  },\n\n  appendToContainer(container) {\n    let baseClass = this.constructor.baseClass + '-' + this._calculateDepth();\n    let className = baseClass + ' ' + this.options.className;\n    let Action; let action;\n    let i; let j; let l; let m;\n\n    this._container = container;\n    this._ul = L.DomUtil.create('ul', className, container);\n    this._ul.style.transform = ( this.options.style ) ? this.options.style : '';\n\n    // Ensure that clicks, drags, etc. don't bubble up to the map.\n    // These are the map events that the L.Draw.Polyline handler listens for.\n    // Note that L.Draw.Polyline listens to 'mouseup', not 'mousedown', but\n    // if only 'mouseup' is silenced, then the map gets stuck in a halfway\n    // state because it receives a 'mousedown' event and is waiting for the\n    // corresponding 'mouseup' event.\n    this._disabledEvents = [\n      'click', 'mousemove', 'dblclick',\n      'mousedown', 'mouseup', 'touchstart',\n    ];\n\n    for (j = 0, m = this._disabledEvents.length; j < m; j++) {\n      L.DomEvent.on(this._ul, this._disabledEvents[j], L.DomEvent.stopPropagation);\n    }\n\n    /* Instantiate each toolbar action and add its corresponding toolbar icon. */\n    for (i = 0, l = this.options.actions.length; i < l; i++) {\n      Action = this._getActionConstructor(this.options.actions[i]);\n\n      action = new Action();\n      action._createIcon(this, this._ul, this._arguments);\n    }\n  },\n});\n\n\nL.OpacitiesAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const mode = edit._mode;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'opacities',\n      tooltip: 'Set custom opacity',\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    options.subToolbar = new L.OpacitiesToolbar2({\n      actions: opacities,\n    });\n\n    L.DistortableImage.action_map.o = mode === 'lock' ? '' : '_setOpacities';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const link = this._link;\n    if (L.DomUtil.hasClass(link, 'subtoolbar_enabled')) {\n      L.DomUtil.removeClass(link, 'subtoolbar_enabled');\n      setTimeout(() => {\n        this.options.subToolbar._hide();\n      }, 100);\n    } else {\n      L.DomUtil.addClass(link, 'subtoolbar_enabled');\n    };\n\n    L.IconUtil.toggleXlink(link, 'opacities', 'cancel');\n    L.IconUtil.toggleTitle(link, 'Make Image Transparent', 'Cancel');\n  },\n});\n","L.GeolocateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'explore',\n      tooltip: overlay.options.translation.geolocateImage,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const image = this._overlay.getElement();\n\n    EXIF.getData(image, L.EXIF(image));\n  },\n});\n","L.IconUtil = {\n  /* creates an svg elemenet with built in accessibility properties\n   * and standardized classes for styling, takes in the fragment\n   * identifier (id) of the symbol to reference. note for symplicity\n   * we allow providing the icon target with or without the '#' prefix\n   */\n  create(ref) {\n    if (/^#/.test(ref)) {\n      ref = ref.replace(/^#/, '');\n    }\n\n    return (\n      '<svg class=\"ldi-icon ldi-' + ref + '\"role=\"img\" focusable=\"false\">' +\n      '<use xlink:href=\"#' + ref + '\"></use>' +\n      '</svg>'\n    );\n  },\n\n  addClassToSvg(container, loader) {\n    const svg = container.querySelector('svg');\n\n    if (svg) {\n      L.DomUtil.addClass(svg, loader);\n    }\n  },\n\n  // finds the use element and toggles its icon reference\n  toggleXlink(container, ref1, ref2) {\n    if (!/^#/.test(ref1)) {\n      ref1 = '#' + ref1;\n    }\n    if (!/^#/.test(ref2)) {\n      ref2 = '#' + ref2;\n    }\n\n    const use = container.querySelector('use');\n    if (use) {\n      const toggled = use.getAttribute('xlink:href') === ref1 ? ref2 : ref1;\n      use.setAttribute('xlink:href', toggled);\n      return toggled;\n    }\n    return false;\n  },\n\n  toggleTitle(container, title1, title2) {\n    const toggled = container.getAttribute('title') === title1 ? title2 : title1;\n\n    container.setAttribute('title', toggled);\n    if (container.hasAttribute('aria-label')) {\n      container.setAttribute('aria-label', toggled);\n    }\n    return toggled;\n  },\n};\n","L.FreeRotateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'crop_rotate',\n      tooltip: overlay.options.translation.freeRotateImage,\n      className: 'freeRotate',\n    };\n\n    L.DistortableImage.action_map.f = '_freeRotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._freeRotateMode();\n  },\n});\n","L.ScaleAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'scale',\n      tooltip: overlay.options.translation.scaleImage,\n      className: 'scale',\n    };\n\n    L.DistortableImage.action_map.s = '_scaleMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._scaleMode();\n  },\n});\n","L.KeymapperIconSet = L.IconSet.extend({\n\n  _symbols:\n      // eslint-disable-next-line max-len\n      '<symbol viewBox=\"0 0 25 25\" id=\"keyboard_open\"><path d=\"M12 23l4-4H8l4 4zm7-15h-2V6h2v2zm0 3h-2V9h2v2zm-3-3h-2V6h2v2zm0 3h-2V9h2v2zm0 4H8v-2h8v2zM7 8H5V6h2v2zm0 3H5V9h2v2zm1-2h2v2H8V9zm0-3h2v2H8V6zm3 3h2v2h-2V9zm0-3h2v2h-2V6zm9-3H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\"/></symbol>',\n\n});\n","L.DistortHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'distort',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAChSURBVO3BIU4DURgGwNkvL2B6AkQTLBqP4QCoSm7DDXoBLBZHDbfgICAIZjEV3YTn9uVHdMZZtcnCfI13bIzxg0emg6Nm6QVbYz3jylEsXRrvwommb49X67jFkz80fR9Mb1YxTzqiWBSLYlEsikWxKBbFolgUi2JRLIpFsSgWxaJY03fHHOu40dH07bAzWCx9Ge/TiWbpHgdsjPGNB2f/yS+7xRCyiiZPJQAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n\n    overlay.setCorner(this._corner, this.getLatLng());\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.distortHandle = function(overlay, idx, options) {\n  return new L.DistortHandle(overlay, idx, options);\n};\n","L.DomUtil = L.DomUtil || {};\nL.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.Keymapper = L.Handler.extend({\n\n  options: {\n    position: 'topright',\n  },\n\n  initialize(map, options) {\n    this._map = map;\n    L.setOptions(this, options);\n  },\n\n  addHooks() {\n    if (!this._keymapper) {\n      this._container = this._buildContainer();\n      this._scrollWrapper = this._wrap();\n      this._toggler = this._createButton();\n      this._setMapper(this._container, this._scrollWrapper, this._toggler);\n\n      L.DomEvent.on(this._toggler, 'click', this._toggleKeymapper, this);\n\n      L.DomEvent.disableClickPropagation(this._container);\n      L.DomEvent.disableScrollPropagation(this._container);\n    }\n  },\n\n  removeHooks() {\n    if (this._keymapper) {\n      L.DomEvent.off(this._toggler, 'click', this._toggleKeymapper, this);\n\n      L.DomUtil.remove(this._toggler);\n      L.DomUtil.remove(this._scrollWrapper);\n      L.DomUtil.remove(this._container);\n      this._keymapper = false;\n    }\n  },\n\n  _buildContainer() {\n    const container = L.DomUtil.create('div', 'ldi-keymapper-hide');\n    container.setAttribute('id', 'ldi-keymapper');\n\n    const divider = L.DomUtil.create('br', 'divider');\n    container.appendChild(divider);\n\n    return container;\n  },\n\n  _createButton() {\n    const toggler = L.DomUtil.create('a', '');\n    toggler.innerHTML = L.IconUtil.create('keyboard_open');\n\n    toggler.setAttribute('id', 'toggle-keymapper');\n    toggler.setAttribute('href', '#');\n    toggler.setAttribute('title', 'Show keymap');\n    // Will force screen readers like VoiceOver to read this as \"Show keymap - button\"\n    toggler.setAttribute('role', 'button');\n    toggler.setAttribute('aria-label', 'Show keymap');\n\n    return toggler;\n  },\n\n  _wrap() {\n    const wrap = L.DomUtil.create('div', '');\n    wrap.setAttribute('id', 'keymapper-wrapper');\n    wrap.style.display = 'none';\n\n    return wrap;\n  },\n\n  _setMapper(container, wrap, button) {\n    this._keymapper = L.control({position: this.options.position});\n\n    this._keymapper.onAdd = function() {\n      container.appendChild(wrap);\n      wrap.insertAdjacentHTML(\n          'beforeend',\n          '<table><tbody>' +\n          '<hr id=\"keymapper-hr\">' +\n          /* eslint-disable */\n          '<tr><td><div class=\"left\"><span>Rotate Mode</span></div><div class=\"right\"><kbd>R</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>RotateScale Mode</span></div><div class=\"right\"><kbd>r</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Scale Mode</span></div><div class=\"right\"><kbd>s</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Distort Mode</span></div><div class=\"right\"><kbd>d</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Drag Mode</span></div><div class=\"right\"><kbd>D</kbd></div></td></tr>' +   \n          '<tr><td><div class=\"left\"><span>Lock (Mode) / Unlock Image</span></div><div class=\"right\"><kbd>l</kbd>\\xa0<kbd>u</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Stack up / down</span></div><div class=\"right\"><kbd>q</kbd>\\xa0<kbd>a</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Add / Remove Image Border</span></div><div class=\"right\"><kbd>b</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Toggle Opacity</span></div><div class=\"right\"><kbd>o</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Deselect All</span></div><div class=\"right\"><kbd>esc</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Delete Image(s)</span></div><div class=\"right\"><kbd>delete</kbd>\\xa0<kbd>backspace</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Export Image(s)</span></div><div class=\"right\"><kbd>e</kbd></div></td></tr>' +\n          '</tbody></table>'\n      );\n      /* eslint-enable */\n      container.appendChild(button);\n      return container;\n    };\n\n    this._keymapper.addTo(this._map);\n  },\n\n  _toggleKeymapper(e) {\n    e.preventDefault();\n\n    this._container.className = (\n      this._container.className === 'ldi-keymapper leaflet-control' ?\n        'ldi-keymapper-hide leaflet-control' :\n        'ldi-keymapper leaflet-control'\n    );\n\n    this._scrollWrapper.style.display = (\n      this._scrollWrapper.style.display === 'none' ? 'block' : 'none'\n    );\n\n    this._toggler.innerHTML = (\n      this._toggler.innerHTML === 'close' ?\n        L.IconUtil.create('keyboard_open') :\n        'close'\n    );\n\n    L.IconUtil.toggleTitle(this._toggler, 'Show keymap', 'Hide keymap');\n    L.DomUtil.toggleClass(this._toggler, 'close-icon');\n  },\n\n  _injectIconSet() {\n    if (document.querySelector('#keymapper-iconset')) { return; }\n\n    const el = L.DomUtil.create('div', '');\n    el.id = 'keymapper-iconset';\n    el.setAttribute('hidden', 'hidden');\n\n    this._iconset = new L.KeymapperIconSet().render();\n    el.innerHTML = this._iconset;\n\n    document.querySelector('.leaflet-control-container').appendChild(el);\n  },\n});\n\nL.DistortableImage.Keymapper.addInitHook(() => {\n  L.DistortableImage.Keymapper.prototype._n = (\n    L.DistortableImage.Keymapper.prototype._n ?\n    L.DistortableImage.Keymapper.prototype._n + 1 :\n    1\n  );\n  // dont enable keymapper for mobile\n  if (L.DistortableImage.Keymapper.prototype._n === 1 && !L.Browser.mobile) {\n    this.enable();\n    this._injectIconSet();\n  }\n});\n\nL.distortableImage.keymapper = (map, options) => {\n  return new L.DistortableImage.Keymapper(map, options);\n};\n","const arr = [];\nL.DistortableCollection = L.FeatureGroup.extend({\n  options: {\n    editable: true,\n    exportOpts: {\n      exportStartUrl: '//export.mapknitter.org/export',\n      statusUrl: '//export.mapknitter.org',\n      exportUrl: 'http://export.mapknitter.org/',\n    },\n  },\n\n  initialize(options) {\n    L.setOptions(this, options);\n    L.FeatureGroup.prototype.initialize.call(this, options);\n    L.Utils.initTranslation.call(this);\n\n    this.editable = this.options.editable;\n  },\n\n  onAdd(map) {\n    L.FeatureGroup.prototype.onAdd.call(this, map);\n\n    this._map = map;\n\n    if (this.editable) { this.editing.enable(); }\n\n    /**\n     * although we have a DistortableCollection.Edit class that handles collection events to keep our code managable,\n     * events that need to be added on individual images are kept here to do so through `layeradd`.\n     */\n    this.on('layeradd', this._addEvents, this);\n    this.on('layerremove', this._removeEvents, this);\n  },\n\n  onRemove() {\n    if (this.editing) { this.editing.disable(); }\n    this.off('layeradd', this._addEvents, this);\n    this.off('layerremove', this._removeEvents, this);\n  },\n\n  _addEvents(e) {\n    const layer = e.layer;\n\n    L.DomEvent.on(layer, {\n      dragstart: this._dragStartMultiple,\n      drag: this._dragMultiple,\n    }, this);\n\n    L.DomEvent.on(layer.getElement(), {\n      mousedown: this._deselectOthers,\n      /* Enable longpress for multi select for touch devices. */\n      contextmenu: this._longPressMultiSelect,\n    }, this);\n  },\n\n  _removeEvents(e) {\n    const layer = e.layer;\n\n    L.DomEvent.off(layer, {\n      dragstart: this._dragStartMultiple,\n      drag: this._dragMultiple,\n    }, this);\n\n    L.DomEvent.off(layer.getElement(), {\n      mousedown: this._deselectOthers,\n      contextmenu: this._longPressMultiSelect,\n    }, this);\n  },\n\n  _longPressMultiSelect(e) {\n    if (!this.editable) { return; }\n\n    e.preventDefault();\n\n    this.eachLayer((layer) => {\n      const edit = layer.editing;\n      if (layer.getElement() === e.target && edit.enabled()) {\n        L.DomUtil.toggleClass(layer.getElement(), 'collected');\n        if (this.anyCollected()) {\n          layer.deselect();\n          this.editing._addToolbar();\n        } else {\n          this.editing._removeToolbar();\n        }\n      }\n    });\n  },\n\n  isCollected(overlay) {\n    return L.DomUtil.hasClass(overlay.getElement(), 'collected');\n  },\n\n  anyCollected() {\n    const layerArr = this.getLayers();\n    return layerArr.some(this.isCollected.bind(this));\n  },\n\n  _toggleCollected(e, layer) {\n    if (e.shiftKey) {\n      /* conditional prevents disabled images from flickering multi-select mode */\n      if (layer.editing.enabled()) {\n        L.DomUtil.toggleClass(e.target, 'collected');\n        // re-order layers by _leaflet_id to match their display order in UI\n        // add new layer to right position and avoid repitition\n        const newArr = arr.every((each) => {\n          return each._leaflet_id !== layer._leaflet_id;\n        });\n        if (newArr) {\n          arr.push(layer);\n        } else {\n          arr.splice(arr.indexOf(layer), 1);\n        }\n      }\n    }\n\n    if (this.anyCollected()) { layer.deselect(); }\n    else { this.editing._removeToolbar(); }\n  },\n\n  _deselectOthers(e) {\n    if (!this.editable) { return; }\n\n    this.eachLayer((layer) => {\n      if (layer.getElement() !== e.target) {\n        layer.deselect();\n      } else {\n        this._toggleCollected(e, layer);\n      }\n    });\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  _dragStartMultiple(e) {\n    const overlay = e.target;\n    const map = this._map;\n    let i;\n\n    if (!this.isCollected(overlay)) { return; }\n\n    this.eachLayer((layer) => {\n      layer._dragStartPoints = {};\n      layer.deselect();\n      for (i = 0; i < 4; i++) {\n        const c = layer.getCorner(i);\n        layer._dragStartPoints[i] = map.latLngToLayerPoint(c);\n      }\n    });\n  },\n\n  _dragMultiple(e) {\n    const overlay = e.target;\n    const map = this._map;\n\n    if (!this.isCollected(overlay)) { return; }\n\n    const topLeft = map.latLngToLayerPoint(overlay.getCorner(0));\n    const delta = overlay._dragStartPoints[0].subtract(topLeft);\n\n    this._updateCollectionFromPoints(delta, overlay);\n  },\n\n  _toRemove() {\n    const layerArr = this.getLayers();\n\n    return layerArr.filter((layer) => {\n      const mode = layer.editing._mode;\n      return (this.isCollected(layer) && mode !== 'lock');\n    });\n  },\n\n  _toMove(overlay) {\n    const layerArr = this.getLayers();\n\n    return layerArr.filter((layer) => {\n      const mode = layer.editing._mode;\n      return layer !== overlay && this.isCollected(layer) && mode !== 'lock';\n    });\n  },\n\n  _updateCollectionFromPoints(delta, overlay) {\n    const layersToMove = this._toMove(overlay);\n    const p = new L.Transformation(1, -delta.x, 1, -delta.y);\n    let i;\n\n    layersToMove.forEach((layer) => {\n      const movedPoints = {};\n      for (i = 0; i < 4; i++) {\n        movedPoints[i] = p.transform(layer._dragStartPoints[i]);\n      }\n      layer.setCornersFromPoints(movedPoints);\n    });\n  },\n\n  _getAvgCmPerPixel(imgs) {\n    const reduce = imgs.reduce(function(sum, img) {\n      return sum + img.cm_per_pixel;\n    }, 0);\n    return reduce / imgs.length;\n  },\n\n  // connects to JSON file and fetches JSON data therein from remote source\n  async fetchRemoteJson(url) {\n    let index = 0;\n    const imgCollectionProps = [];\n\n    try {\n      const response = await axios.get(url);\n      if (response.data.hasOwnProperty('avg_cm_per_pixel')) {\n        if (response.data.collection.length > 1) {\n          response.data.collection.forEach((data) => {\n            imgCollectionProps[index] = data;\n            index++;\n          });\n          return {\n            avg_cm_per_pixel: response.data.avg_cm_per_pixel,\n            imgCollectionProps,\n          };\n        }\n        imgCollectionProps[index] = response.data.collection;\n\n        return {\n          avg_cm_per_pixel: response.data.avg_cm_per_pixel,\n          imgCollectionProps,\n        };\n      } else {\n        if (response.data.length > 1) {\n          response.data.forEach((data) => {\n            imgCollectionProps[index] = data;\n            index++;\n          });\n          return {\n            imgCollectionProps,\n          };\n        }\n        imgCollectionProps[index] = response.data;\n\n        return {\n          imgCollectionProps,\n        };\n      }\n    } catch (err) {\n      console.log('err', err);\n    }\n  },\n\n  // expects url in this format: https://archive.org/download/mkl-1/mkl-1.json\n  async recreateImagesFromJsonUrl(url) {\n    let imageCollectionObj = {};\n\n    if (url) {\n      imageCollectionObj = await this.fetchRemoteJson(url);\n      return imageCollectionObj;\n    };\n\n    return imageCollectionObj;\n  },\n\n  generateExportJson(allImages = false) {\n    const json = {};\n    json.images = [];\n\n    this.eachLayer(function(layer) {\n      if (allImages || this.isCollected(layer)) {\n        const sections = layer._image.src.split('/');\n        const filename = sections[sections.length - 1];\n        const zc = layer.getCorners();\n\n        const corners = [\n          {lat: zc[0].lat, lon: zc[0].lng || zc[0].lon},\n          {lat: zc[1].lat, lon: zc[1].lng || zc[1].lon},\n          {lat: zc[3].lat, lon: zc[3].lng || zc[3].lon},\n          {lat: zc[2].lat, lon: zc[2].lng || zc[2].lon},\n        ];\n\n        json.images.push({\n          id: layer._leaflet_id,\n          src: layer._image.src,\n          width: layer._image.width,\n          height: layer._image.height,\n          tooltipText: layer.getTooltipText(),\n          image_file_name: filename,\n          nodes: corners,\n          cm_per_pixel: L.ImageUtil.getCmPerPixel(layer),\n        });\n      }\n    }, this);\n\n    json.images = json.images.reverse();\n    json.avg_cm_per_pixel = this._getAvgCmPerPixel(json.images);\n    return json;\n  },\n});\n\nL.distortableCollection = function(id, options) {\n  return new L.DistortableCollection(id, options);\n};\n","L.FreeRotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'freeRotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng);\n\n    if (angle !== 0) { overlay.rotateBy(angle, 'rad'); }\n\n    let edgeMinWidth = overlay.edgeMinWidth;\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n\n    const corner1 = map.latLngToContainerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToContainerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale);\n    } else {\n      overlay.scaleBy(1);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.freeRotateHandle = (overlay, idx, options) => {\n  return new L.FreeRotateHandle(overlay, idx, options);\n};\n","L.ExportAction = L.EditAction.extend({\n  // This function is executed every time we select an image\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    let tooltip;\n\n    this.isExporting = false;\n    this.mouseLeaveSkip = true;\n    this.isHooksExecuted = false;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      L.DistortableImage.action_map.e = '_getExport';\n      tooltip = overlay.options.translation.exportImage;\n    } else {\n      L.DistortableImage.group_action_map.e = 'runExporter';\n      tooltip = overlay.options.translation.exportImages;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'get_app',\n      tooltip: tooltip,\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      edit._getExport();\n      return;\n    }\n\n    // Make sure that addHooks is executed only once, event listeners will handle the rest\n    if (this.isHooksExecuted) {\n      return;\n    } else {\n      this.isHooksExecuted = true;\n    }\n\n    const exportTool = this._link.parentElement;\n\n    this.mouseEnterHandler = this.handleMouseEnter.bind(this);\n    this.mouseLeaveHandler = this.handleMouseLeave.bind(this);\n\n    L.DomEvent.on(exportTool, 'click', function() {\n      if (!this.isExporting) {\n        this.isExporting = true;\n        this.renderExportIcon();\n\n        setTimeout(this.attachMouseEventListeners.bind(this, exportTool), 100);\n        edit.runExporter().then(\n            function() {\n              this.resetState();\n              this.detachMouseEventListeners(exportTool);\n            }.bind(this)\n        );\n      } else {\n        // Clicking on the export icon after export has started will be ignored\n        if (this.mouseLeaveSkip) {\n          return;\n        }\n\n        this.resetState();\n        this.detachMouseEventListeners(exportTool);\n        edit.cancelExport();\n      }\n    }, this);\n  },\n\n  resetState() {\n    this.renderDownloadIcon();\n    this.isExporting = false;\n    this.mouseLeaveSkip = true;\n  },\n\n  attachMouseEventListeners(element) {\n    element.addEventListener('mouseenter', this.mouseEnterHandler);\n    element.addEventListener('mouseleave', this.mouseLeaveHandler);\n  },\n\n  detachMouseEventListeners(element) {\n    element.removeEventListener('mouseenter', this.mouseEnterHandler);\n    element.removeEventListener('mouseleave', this.mouseLeaveHandler);\n  },\n\n  handleMouseEnter() {\n    this.renderCancelIcon();\n  },\n\n  handleMouseLeave() {\n    if (this.mouseLeaveSkip) {\n      this.mouseLeaveSkip = false;\n    } else {\n      this.renderExportIcon();\n    }\n  },\n\n  renderDownloadIcon() {\n    L.IconUtil.toggleXlink(this._link, 'get_app', 'spinner');\n    L.IconUtil.toggleTitle(this._link, 'Export Images', 'Loading...');\n    L.DomUtil.removeClass(this._link.firstChild, 'loader');\n  },\n\n  renderExportIcon() {\n    L.IconUtil.toggleXlink(this._link, 'spinner');\n    L.IconUtil.toggleTitle(this._link, 'Export Images', 'Loading...');\n    L.IconUtil.addClassToSvg(this._link, 'loader');\n  },\n\n  renderCancelIcon() {\n    L.IconUtil.toggleXlink(this._link, 'cancel');\n    L.IconUtil.toggleTitle(this._link, 'Cancel Export', 'Loading...');\n    L.DomUtil.removeClass(this._link.firstChild, 'loader');\n  },\n});\n","L.ScaleHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'scale',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NTkiIGhlaWdodD0iNDY0IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MTIgNTEyIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgY2xhc3M9IiIgc3R5bGU9IiIvPjxnIGNsYXNzPSJjdXJyZW50TGF5ZXIiIHN0eWxlPSIiPjx0aXRsZT5MYXllciAxPC90aXRsZT48cGF0aCBkPSJNNDU5LjA0OTE1OTUzMDQ3MTM0LDg2LjkyNjIzNDUxMjU1MDAyIFYwIGgtODUuNzE0NTczMzU2MzEyMDkgdjI3LjA0MzcxNzQwMzkwNDQ1MiBIODUuNzE0NTczMzU2MzEyMDMgVjAgSDAgdjg2LjkyNjIzNDUxMjU1MDAyIGgyNS43MTQzNzIwMDY4OTM2MjYgdjI4OS43NTQxMTUwNDE4MzM0IEgwIHY4Ni45MjYyMzQ1MTI1NTAwMiBoODUuNzE0NTczMzU2MzEyMDkgdi0yNy4wNDM3MTc0MDM5MDQ0NTIgaDI4NS43MTUyNDQ1MjEwNDAzIHYyNy4wNDM3MTc0MDM5MDQ0NTIgaDg1LjcxNDU3MzM1NjMxMjA5IHYtODYuOTI2MjM0NTEyNTUwMDIgaC0yMy44MDk2MDM3MTAwODY2OSBWODYuOTI2MjM0NTEyNTUwMDIgSDQ1OS4wNDkxNTk1MzA0NzEzNCB6TTM4NC43NjMxOTU5NTUwMDA5LDEyLjU1NjAxMTY1MTgxMjc4MSBoNjEuOTA0OTY5NjQ2MjI1Mzk2IHY2Mi43ODAwNTgyNTkwNjM5MSBoLTYxLjkwNDk2OTY0NjIyNTM5NiBWMTIuNTU2MDExNjUxODEyNzgxIHpNMTIuMzgwOTkzOTI5MjQ1MDUsMTIuNTU2MDExNjUxODEyNzgxIGg2MS45MDQ5Njk2NDYyMjUzOTYgdjYyLjc4MDA1ODI1OTA2MzkxIEgxMi4zODA5OTM5MjkyNDUwNSBWMTIuNTU2MDExNjUxODEyNzgxIHpNNzQuMjg1OTYzNTc1NDcwNTMsNDUxLjA1MDU3MjQxNTEyMDY2IEgxMi4zODA5OTM5MjkyNDUwNSB2LTYyLjc4MDA1ODI1OTA2MzkxIGg2MS45MDQ5Njk2NDYyMjUzOTYgVjQ1MS4wNTA1NzI0MTUxMjA2NiB6TTQ0NS43MTU3ODE0NTI4MjI3NCw0NTEuMDUwNTcyNDE1MTIwNjYgaC02Mi44NTczNTM3OTQ2Mjg4NjQgdi02Mi43ODAwNTgyNTkwNjM5MSBoNjIuODU3MzUzNzk0NjI4ODY0IFY0NTEuMDUwNTcyNDE1MTIwNjYgek00MDcuNjIwNDE1NTE2Njg0MjYsMzc2LjY4MDM0OTU1NDM4MzQ0IGgtMzYuMTkwNTk3NjM5MzMxNzcgdjMyLjgzODc5OTcwNDc0MTEyIEg4NS43MTQ1NzMzNTYzMTIwMyB2LTMyLjgzODc5OTcwNDc0MTEyIEg0OS41MjM5NzU3MTY5ODAzMiBWODYuOTI2MjM0NTEyNTUwMDIgaDM2LjE5MDU5NzYzOTMzMTc3IFY1MC4yMjQwNDY2MDcyNTExMjUgaDI4Ny42MjAwMTI4MTc4NDcyIHYzNi43MDIxODc5MDUyOTg5IGgzNC4yODU4MjkzNDI1MjQ4MzUgVjM3Ni42ODAzNDk1NTQzODM0NCB6IiBpZD0ic3ZnXzIiIGNsYXNzPSIiIGZpbGw9IiMxYTFhZWIiIGZpbGwtb3BhY2l0eT0iMSIvPjwvZz48L3N2Zz4=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    let edgeMinWidth = overlay.edgeMinWidth;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng);\n\n    /*\n     * checks whether the \"edgeMinWidth\" property is set and tracks the minimum edge length;\n     * this enables preventing scaling to zero, but we might also add an overall scale limit\n     */\n\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n    const corner1 = map.latLngToLayerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToLayerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale);\n      /*\n       * running scale logic even for a scale ratio of 1\n       * prevents a small, occasional marker flicker\n       */\n    } else {\n      overlay.scaleBy(1);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.scaleHandle = function(overlay, idx, options) {\n  return new L.ScaleHandle(overlay, idx, options);\n};\n","L.BorderAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const mode = edit._mode;\n    let use;\n    let tooltip;\n\n    if (edit._outlined) {\n      use = 'border_outer';\n      tooltip = overlay.options.translation.removeBorder;\n    } else {\n      use = 'border_clear';\n      tooltip = overlay.options.translation.addBorder;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    // conditional for disabling keybindings for this action when the image is locked.\n    L.DistortableImage.action_map.b = mode === 'lock' ? '' : '_toggleBorder';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    L.IconUtil.toggleXlink(this._link, 'border_clear', 'border_outer');\n    L.IconUtil.toggleTitle(this._link, 'Remove Border', 'Add Border');\n    edit._toggleBorder();\n  },\n});\n","L.Utils = {\n  initTranslation() {\n    const translation = {\n      deleteImage: 'Delete Image',\n      deleteImages: 'Delete Images',\n      distortImage: 'Distort Image',\n      dragImage: 'Drag Image',\n      exportImage: 'Export Image',\n      exportImages: 'Export Images',\n      removeBorder: 'Remove Border',\n      addBorder: 'Add Border',\n      freeRotateImage: 'Free rotate Image',\n      geolocateImage: 'Geolocate Image',\n      lockMode: 'Lock Mode',\n      lockImages: 'Lock Images',\n      makeImageOpaque: 'Make Image Opaque',\n      makeImageTransparent: 'Make Image Transparent',\n      restoreImage: 'Restore Natural Image',\n      rotateImage: 'Rotate Image',\n      scaleImage: 'Scale Image',\n      stackToFront: 'Stack to Front',\n      stackToBack: 'Stack to Back',\n      unlockImages: 'Unlock Images',\n      confirmImageDelete:\n        'Are you sure? This image will be permanently deleted from the map.',\n      confirmImagesDeletes:\n        'Are you sure? These images will be permanently deleted from the map.',\n    };\n\n    if (!this.options.translation) {\n      this.options.translation = translation;\n    } else {\n      // If the translation for a word is not specified, fallback to English.\n      for (const key in translation) {\n        if (!this.options.translation.hasOwnProperty(key)) {\n          this.options.translation[key] = translation[key];\n        }\n      }\n    }\n\n    L.DomUtil.initTranslation(this.options.translation);\n  },\n\n  getNestedVal(obj, key, nestedKey) {\n    const dig = [key, nestedKey];\n    return dig.reduce(function(obj, k) {\n      return obj && obj[k];\n    }, obj);\n  },\n};\n","L.DragHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'drag',\n    icon: L.icon({\n      // eslint-disable-next-line max-len\n      iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAsVJREFUeNrMVztLXEEUvnNVFAVBAhY2aRKbTZEHJNpYabuNjSgYg/GxdsmPSJkUAa/ZdVEX8mgWYVutbHxAHkVskjQBuUUgBISVhCQk3wnfwMlk1rusN1wHPubOzJlzvjlz5sxc01Ma/hUEwQnwDIjqc7uvgv9YYO86qgIwCXQbdNTlQ8kcCBHgBch8TcloF6oJGr6phk6EQAkfdz3zvgDr9Mr7Fg1fptEZoM8jsmrokpfsiIFO4IIjuE2v1EDmR4LRdlR5Gh51hj8D34ABtm8YTtqna0TgklIw5CgQguKxIojEjmFROg/MKQO27NkFAB+4wAPouGUJiIvWKHwbAxX2XyWRKWkqhT+pbJntJZJuUzISW0+5hW+obxrVBsfvoH/dqCCJuU97GBh2VteLSiYvArmErT8EVoAK9Bw7enbpVYmvAQlyowYforrH5jXL2rPHI/TKONDB7u9AlavdaTBPvPmazUeQuy8f7UomUgTEwIJPEQ3sQGE/6ll2l9H/KcEzBcfWn2IclluM3DpddJxSHujlFkscbUPvmB0LHVnLrId7nlaZVkEc6QGXQI1MAwZcWmVRHeNaQwJMMiU2cwy4s7p/RJ2ckpvIQs+cIs+5GzitloLKHUV3MPREuXbTOKO91dX387gGTONxIgEWm+E61FFrpcyqXLHsEwiDjEsjAksqw5XPoL9MHVrn6QR4q+XZrDaR4RoWzq2ymafuRA/Mq1stSsHLVkcbdf9VjOcx8ZH3+SFWcCWlVPyWuUBOwUWdC1wP5NVjYiXFWLO69PZ6CRTUY6KSIoEKdf6T3IzzgHxnsyHctNBEkmn6Oob8ExUDg/ahGybd177cDjzH5xHwgDiSvoS7I/LZyvxJZj0wod7tkX5G0XVC7rEyLhfLJjBGbKoLLEfZWObyKeZ6oY82g+yf5Zn/mJyHX7PMf04z/T3/LcAAu4E6iiyJqf0AAAAASUVORK5CYII=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n\n    overlay.dragBy(formerLatLng, newLatLng);\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.dragHandle = function(overlay, idx, options) {\n  return new L.DragHandle(overlay, idx, options);\n};\n","L.distortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.group_action_map = {};\n\nL.DistortableImage.ControlBar = L.Toolbar2.Control.extend({});\n\nL.distortableImage.controlBar = function(options) {\n  return new L.DistortableImage.ControlBar(options);\n};\n\n/** addInitHooks run before onAdd */\nL.DistortableCollection.addInitHook(function() {\n  /** Default actions */\n  this.ACTIONS = [\n    L.ExportAction,\n    L.DeleteAction,\n    L.LockAction,\n    L.UnlockAction,\n  ];\n\n  // all possible modes\n  L.DistortableCollection.Edit.MODES = {\n    lock: L.LockAction,\n    unlock: L.UnlockAction,\n  };\n\n  const a = this.options.actions ? this.options.actions : this.ACTIONS;\n\n  this.editing = L.distortableCollection.edit(this, {actions: a});\n});\n","/* this is the baseclass other IconSets inherit from,\n* we don't use it directly */\nL.IconSet = L.Class.extend({\n\n  _svg: '<svg xmlns=\"http://www.w3.org/2000/svg\">',\n\n  _symbols: '',\n\n  render() {\n    this.addSymbols(this._symbols);\n    return this._svg;\n  },\n\n  addSymbols(symbols) {\n    this._svg += symbols;\n  },\n});\n","L.TrigUtil = {\n\n  calcAngle(x, y, unit = 'deg') {\n    return unit === 'deg' ?\n        this.radiansToDegrees(Math.atan2(y, x)) :\n        Math.atan2(y, x);\n  },\n\n  radiansToDegrees(angle) {\n    return (angle * 180) / Math.PI;\n  },\n\n  degreesToRadians(angle) {\n    return (angle * Math.PI) / 180;\n  },\n};\n","L.OpacityAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const mode = edit._mode;\n    let use;\n    let tooltip;\n\n    if (edit._transparent) {\n      use = 'opacity_empty';\n      tooltip = overlay.options.translation.makeImageOpaque;\n    } else {\n      use = 'opacity';\n      tooltip = overlay.options.translation.makeImageTransparent;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.DistortableImage.action_map.o = mode === 'lock' ? '' : '_toggleOpacity';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    const link = this._link;\n\n    L.IconUtil.toggleXlink(link, 'opacity', 'opacity_empty');\n    L.IconUtil.toggleTitle(link, 'Make Image Transparent', 'Make Image Opaque');\n    edit._toggleOpacity();\n  },\n});\n","L.DistortAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'distort',\n      tooltip: overlay.options.translation.distortImage,\n      className: 'distort',\n    };\n\n    L.DistortableImage.action_map.d = '_distortMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._distortMode();\n  },\n});\n","L.DeleteAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const use = 'delete_forever';\n    let tooltip;\n    /**\n      * we can tell whether the overlay is an instance of `L.DistortableImageOverlay` or `L.DistortableCollection` bc only\n      * the former should have `parentGroup` defined on it. From there we call the apporpriate keybindings and methods.\n      */\n    if (edit instanceof L.DistortableImage.Edit) {\n      tooltip = overlay.options.translation.deleteImage;\n      // backspace windows / delete mac\n      L.DistortableImage.action_map.Backspace = (\n        edit._mode === 'lock' ? '' : '_removeOverlay'\n      );\n    } else {\n      tooltip = overlay.options.translation.deleteImages;\n      L.DistortableImage.group_action_map.Backspace = (\n        edit._mode === 'lock' ? '' : '_removeGroup'\n      );\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) { edit._removeOverlay(); }\n    else { edit._removeGroup(); }\n  },\n});\n","L.Map.mergeOptions({\n  boxCollector: true,\n  boxZoom: false,\n});\n\n/**\n * primarily Leaflet 1.5.1 source code. Overriden so that it's a collection box used with\n * our `L.DistortableCollection` class instead of a zoom box.\n * */\nL.Map.BoxCollector = L.Map.BoxZoom.extend({\n  initialize(map) {\n    this._map = map;\n    this._container = map._container;\n    this._pane = map._panes.overlayPane;\n    this._resetStateTimeout = 0;\n    map.on('unload', this._destroy, this);\n  },\n\n  addHooks() {\n    L.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\n  },\n\n  removeHooks() {\n    L.DomEvent.off(this._container, 'mousedown', this._onMouseDown, this);\n  },\n\n  moved() {\n    return this._moved;\n  },\n\n  _destroy() {\n    L.DomUtil.remove(this._pane);\n    delete this._pane;\n  },\n\n  _resetState() {\n    this._resetStateTimeout = 0;\n    this._moved = false;\n  },\n\n  _clearDeferredResetState() {\n    if (this._resetStateTimeout !== 0) {\n      clearTimeout(this._resetStateTimeout);\n      this._resetStateTimeout = 0;\n    }\n  },\n\n  _onMouseDown(e) {\n    if (!e.shiftKey || (e.which !== 1 && e.button !== 1)) {\n      return false;\n    }\n\n    // Clear the deferred resetState if it hasn't executed yet, otherwise it\n    // will interrupt the interaction and orphan a box element in the container.\n    this._clearDeferredResetState();\n    this._resetState();\n\n    L.DomUtil.disableTextSelection();\n    L.DomUtil.disableImageDrag();\n\n    this._startPoint = this._map.mouseEventToContainerPoint(e);\n\n    L.DomEvent.on(document, {\n      contextmenu: L.DomEvent.stop,\n      mousemove: this._onMouseMove,\n      mouseup: this._onMouseUp,\n    }, this);\n  },\n\n  _onMouseMove(e) {\n    if (!this._moved) {\n      this._moved = true;\n\n      this._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._container);\n      L.DomUtil.addClass(this._container, 'leaflet-crosshair');\n\n      this._map.fire('boxzoomstart');\n    }\n\n    this._point = this._map.mouseEventToContainerPoint(e);\n\n    this._bounds = L.bounds(this._startPoint, this._point);\n    const size = this._bounds.getSize();\n\n    L.DomUtil.setPosition(this._box, this._bounds.min);\n\n    this._box.style.width = size.x + 'px';\n    this._box.style.height = size.y + 'px';\n  },\n\n  _finish() {\n    if (this._moved) {\n      L.DomUtil.remove(this._box);\n      L.DomUtil.removeClass(this._container, 'leaflet-crosshair');\n    }\n\n    L.DomUtil.enableTextSelection();\n    L.DomUtil.enableImageDrag();\n\n    L.DomEvent.off(document, {\n      contextmenu: L.DomEvent.stop,\n      mousemove: this._onMouseMove,\n      mouseup: this._onMouseUp,\n    }, this);\n  },\n\n  _onMouseUp(e) {\n    if (e.which !== 1 && e.button !== 1) {\n      return;\n    }\n\n    this._finish();\n\n    if (!this._moved) { return; }\n\n    // Postpone to next JS tick so internal click event handling\n    // still see it as \"moved\".\n    this._clearDeferredResetState();\n    this._resetStateTimeout = setTimeout(\n        L.Util.bind(this._resetState, this), 0);\n\n    let bounds = L.latLngBounds(\n        this._map.containerPointToLatLng(this._bounds.getBottomLeft()),\n        this._map.containerPointToLatLng(this._bounds.getTopRight())\n    );\n\n    const zoom = this._map.getZoom();\n    const center = this._map.getCenter();\n\n    // calls the `project` method but 1st updates the pixel origin - see https://github.com/publiclab/Leaflet.DistortableImage/pull/344\n    bounds = this._map._latLngBoundsToNewLayerBounds(bounds, zoom, center);\n\n    this._map.fire('boxcollectend', {boxCollectBounds: bounds});\n  },\n});\n\nL.Map.addInitHook('addHandler', 'boxCollector', L.Map.BoxCollector);\n","L.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.action_map = {};\n\nL.DistortableImage.PopupBar = L.Toolbar2.Popup.extend({\n  options: {\n    anchor: [0, -10],\n  },\n\n  initialize(latlng, options) {\n    L.setOptions(this, options);\n    L.Toolbar2.Popup.prototype.initialize.call(this, latlng, options);\n  },\n\n  addHooks(map, ov) {\n    this.map = map;\n    this.ov = ov;\n  },\n\n  tools() {\n    if (this._ul) {\n      return this._ul.children;\n    }\n  },\n\n  clickTool(name) {\n    const tools = this.tools();\n    for (let i = 0; i < tools.length; i++) {\n      const tool = tools.item(i).children[0];\n      if (L.DomUtil.hasClass(tool, name)) {\n        tool.click();\n        return tool;\n      }\n    }\n    return false;\n  },\n});\n\nL.distortableImage.popupBar = function(latlng, options) {\n  return new L.DistortableImage.PopupBar(latlng, options);\n};\n\nL.DistortableImageOverlay.addInitHook(function() {\n  /** Default actions */\n  this.ACTIONS = [\n    L.DragAction,\n    L.ScaleAction,\n    L.DistortAction,\n    L.RotateAction,\n    L.FreeRotateAction,\n    L.LockAction,\n    L.OpacityAction,\n    L.OpacitiesAction,\n    L.BorderAction,\n    L.ExportAction,\n    L.DeleteAction,\n  ];\n\n  // all possible modes\n  L.DistortableImage.Edit.MODES = {\n    drag: L.DragAction,\n    scale: L.ScaleAction,\n    distort: L.DistortAction,\n    rotate: L.RotateAction,\n    freeRotate: L.FreeRotateAction,\n    lock: L.LockAction,\n  };\n\n  const a = this.options.actions ? this.options.actions : this.ACTIONS;\n\n  this.editing = L.distortableImage.edit(this, {actions: a});\n});\n","L.DistortableImage = L.DistortableImage || {};\n\n// holds the keybindings & toolbar API for an individual image instance\nL.DistortableImage.Edit = L.Handler.extend({\n  options: {\n    opacity: 0.5,\n    outline: '1px solid red',\n    keymap: L.distortableImage.action_map,\n  },\n\n  initialize(overlay, options) {\n    this._overlay = overlay;\n    this._toggledImage = false;\n    this._mode = overlay.options.mode;\n    this._transparent = false;\n    this._outlined = false;\n    this._opacity = options.opacity;\n\n    L.setOptions(this, options);\n\n    L.distortableImage.action_map.Escape = '_deselect';\n  },\n\n  /* Run on image selection. */\n  addHooks() {\n    const overlay = this._overlay;\n\n    this.editActions = this.options.actions;\n\n    /* bring the selected image into view */\n    overlay.bringToFront();\n    this._initModes();\n    this._initHandles();\n    this._appendHandlesandDragable();\n\n    if (overlay.isSelected() && !overlay.options.suppressToolbar) {\n      this._addToolbar();\n    }\n\n    this.parentGroup = overlay.eP ? overlay.eP : false;\n\n    L.DomEvent.on(overlay.getElement(), {\n      dblclick: this.nextMode,\n    }, this);\n\n    L.DomEvent.on(window, 'keydown', this._onKeyDown, this);\n  },\n\n  /* Run on image deselection. */\n  removeHooks() {\n    const overlay = this._overlay;\n    const eP = this.parentGroup;\n\n    // First, check if dragging exists - it may be off due to locking\n    this._disableDragging();\n\n    if (this.toolbar) { this._removeToolbar(); }\n\n    for (const handle in this._handles) {\n      L.DomUtil.remove(handle);\n    }\n\n    /**\n     * ensures if you disable an image while it is multi-selected\n     * additional deselection logic is run\n     */\n    if (L.DomUtil.hasClass(overlay.getElement(), 'collected')) {\n      L.DomUtil.removeClass(overlay.getElement(), 'collected');\n    }\n\n    if (eP && (!eP.anyCollected() && eP.editing.toolbar)) {\n      eP.editing._removeToolbar();\n    }\n\n    L.DomEvent.off(overlay.getElement(), {\n      dblclick: this.nextMode,\n    }, this);\n\n    L.DomEvent.off(window, 'keydown', this._onKeyDown, this);\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    this._overlay.deselect();\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _initModes() {\n    this._modes = {};\n    // passed from L.DistortablImage.PopupBar. If the mode is one\n    // of the current toolbar actions, adds it to this._modes\n    for (const mode in L.DistortableImage.Edit.MODES) {\n      const action = L.DistortableImage.Edit.MODES[mode];\n      if (this.editActions.indexOf(action) !== -1) {\n        this._modes[mode] = action;\n      }\n    }\n\n    // sets the current mode to the 1st available one if the one selected\n    // during initialization is not available\n    if (!this._modes[this._mode]) {\n      this._mode = Object.keys(this._modes)[0];\n    }\n  },\n\n\n  _initHandles() {\n    const overlay = this._overlay;\n    let i;\n\n    this._dragHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._dragHandles.addLayer(L.dragHandle(overlay, i));\n    }\n\n    this._scaleHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._scaleHandles.addLayer(L.scaleHandle(overlay, i));\n    }\n\n    this._distortHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._distortHandles.addLayer(L.distortHandle(overlay, i));\n    }\n\n    this._rotateHandles = L.layerGroup(); // individual rotate\n    for (i = 0; i < 4; i++) {\n      this._rotateHandles.addLayer(L.rotateHandle(overlay, i));\n    }\n\n    // handle includes rotate AND scale\n    this._freeRotateHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._freeRotateHandles.addLayer(L.freeRotateHandle(overlay, i));\n    }\n\n    this._lockHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._lockHandles.addLayer(L.lockHandle(overlay, i, {draggable: false}));\n    }\n\n    this._handles = {\n      drag: this._dragHandles,\n      scale: this._scaleHandles,\n      distort: this._distortHandles,\n      rotate: this._rotateHandles,\n      freeRotate: this._freeRotateHandles,\n      lock: this._lockHandles,\n    };\n  },\n\n  _appendHandlesandDragable() {\n    const ov = this._overlay;\n\n    // won't throw error if user adds 0 mode actions to toolbar\n    if (!this._mode) {\n      this._enableDragging();\n      return;\n    }\n\n    this._updateHandle();\n\n    if (!ov.isSelected() && this.currentHandle) {\n      this.currentHandle.eachLayer((handle) => {\n        handle.setOpacity(0);\n        if (handle.dragging) { handle.dragging.disable(); }\n      });\n    }\n    if (!this.isMode('lock')) { this._enableDragging(); }\n  },\n\n  _onKeyDown(e) {\n    const keymap = this.options.keymap;\n    const handlerName = keymap[e.key];\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n\n    if (eP && eP.anyCollected()) { return; }\n\n    if (this[handlerName] !== undefined && !ov.options.suppressToolbar) {\n      if (ov.isSelected() && this.toolbar) {\n        this[handlerName].call(this);\n      }\n    }\n  },\n\n  replaceTool(old, next) {\n    if (next.baseClass !== 'leaflet-toolbar-icon' || this.hasTool(next)) {\n      return this;\n    }\n    this.editActions.some((item, idx) => {\n      if (item === old) {\n        this._removeToolbar();\n        this.editActions[idx] = next;\n        this._addToolbar();\n        for (const mode in L.DistortableImage.Edit.MODES) {\n          if (L.DistortableImage.Edit.MODES[mode] === old) {\n            delete this._modes[mode];\n            this._nextOrNone(mode);\n          } else if (L.DistortableImage.Edit.MODES[mode] === next) {\n            this._modes[mode] = next;\n          }\n        }\n        return true;\n      }\n    });\n    return this;\n  },\n\n  addTool(value) {\n    if (value.baseClass === 'leaflet-toolbar-icon' && !this.hasTool(value)) {\n      this._removeToolbar();\n      this.editActions.push(value);\n      this._addToolbar();\n      for (const mode in L.DistortableImage.Edit.MODES) {\n        if (L.DistortableImage.Edit.MODES[mode] === value) {\n          this._modes[mode] = value;\n        }\n      }\n      if (!this._overlay.isSelected()) { this._removeToolbar(); }\n    }\n    return this;\n  },\n\n  hasTool(value) {\n    return this.editActions.some(action => action === value);\n  },\n\n  removeTool(value) {\n    this.editActions.some((item, idx) => {\n      if (item === value) {\n        this._removeToolbar();\n        this.editActions.splice(idx, 1);\n        this._addToolbar();\n        for (const mode in L.DistortableImage.Edit.MODES) {\n          if (L.DistortableImage.Edit.MODES[mode] === value) {\n            delete this._modes[mode];\n            this._nextOrNone(mode);\n          }\n        }\n        return true;\n      }\n    });\n    if (!this._overlay.isSelected()) { this._removeToolbar(); }\n    return this;\n  },\n\n  // set the mode to the next mode or if that was the last one set mode to ''\n  _nextOrNone(mode) {\n    if (this.isMode(mode)) {\n      if (Object.keys(this.getModes()).length >= 1) {\n        this.nextMode();\n      } else {\n        if (mode === 'lock') { this._enableDragging(); }\n        this._mode = '';\n        this._updateHandle();\n      }\n    }\n  },\n\n  _removeToolbar() {\n    const ov = this._overlay;\n    const map = ov._map;\n\n    if (this.toolbar) {\n      map.removeLayer(this.toolbar);\n      this.toolbar = false;\n    }\n  },\n\n  _enableDragging() {\n    const overlay = this._overlay;\n    const map = overlay._map;\n\n    this.dragging = new L.Draggable(overlay.getElement());\n    this.dragging.enable();\n\n    /* Hide toolbars and markers while dragging; click will re-show it */\n    this.dragging.on('dragstart', () => {\n      overlay.fire('dragstart');\n      this._removeToolbar();\n    });\n\n    /*\n     * Adjust default behavior of L.Draggable, which overwrites the CSS3\n     * distort transformations that we set when it calls L.DomUtil.setPosition.\n     */\n    this.dragging._updatePosition = function() {\n      const topLeft = overlay.getCorner(0);\n      const delta = this._newPos.subtract(map.latLngToLayerPoint(topLeft));\n      let currentPoint;\n      const corners = {};\n      let i;\n\n      this.fire('predrag');\n\n      for (i = 0; i < 4; i++) {\n        currentPoint = map.latLngToLayerPoint(overlay.getCorner(i));\n        corners[i] = map.layerPointToLatLng(currentPoint.add(delta));\n      }\n\n      overlay.setCorners(corners);\n      overlay.fire('drag');\n\n      this.fire('drag');\n    };\n\n    this.dragging.on('dragend', () => {\n      overlay.fire('dragend');\n    });\n  },\n\n  _disableDragging() {\n    if (this.dragging) {\n      this.dragging.disable();\n      delete this.dragging;\n    }\n  },\n\n  _dragMode() {\n    this.setMode('drag');\n  },\n\n  _scaleMode() {\n    this.setMode('scale');\n  },\n\n  _distortMode() {\n    this.setMode('distort');\n  },\n\n  _rotateMode() {\n    this.setMode('rotate');\n  },\n\n  _freeRotateMode() {\n    this.setMode('freeRotate');\n  },\n\n  _toggleLockMode() {\n    if (this.isMode('lock')) { this._unlock(); }\n    else { this._lock(); }\n  },\n\n  _toggleOpacity() {\n    const image = this._overlay.getElement();\n\n    if (!this.hasTool(L.OpacityAction)) { return; }\n\n    this._transparent = !this._transparent;\n    const opacity = this._transparent ? this.options.opacity : 1;\n\n    L.DomUtil.setOpacity(image, opacity);\n    image.setAttribute('opacity', opacity);\n\n    this._refresh();\n  },\n\n  _setOpacities(o) {\n    const image = this._overlay.getElement();\n    this._opacity = o;\n    if (!this.hasTool(L.OpacitiesAction)) { return; }\n\n    (this._opacity < 1) ? this._transparent = true : this._transparent = false;\n\n    L.DomUtil.setOpacity(image, this._opacity);\n    image.setAttribute('opacity', this._opacity);\n\n    this._refresh();\n  },\n\n  _toggleBorder() {\n    const image = this._overlay.getElement();\n\n    if (!this.hasTool(L.BorderAction)) { return; }\n\n    this._outlined = !this._outlined;\n    const outline = this._outlined ? this.options.outline : 'none';\n\n    image.style.outline = outline;\n\n    this._refresh();\n  },\n\n  // compare this to using overlay zIndex\n  _toggleOrder() {\n    if (this._toggledImage) { this._stackUp(); }\n    else { this._stackDown(); }\n  },\n\n  _removeOverlay() {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n\n    if (this.isMode('lock') || !this.hasTool(L.DeleteAction)) { return; }\n\n    const choice = L.DomUtil.confirmDelete();\n    if (!choice) { return; }\n\n    this._removeToolbar();\n\n    if (eP) { eP.removeLayer(ov); }\n    else { ov._map.removeLayer(ov); }\n  },\n\n  // Based on https://github.com/publiclab/mapknitter/blob/8d94132c81b3040ae0d0b4627e685ff75275b416/app/assets/javascripts/mapknitter/Map.js#L47-L82\n  _getExport() {\n    const overlay = this._overlay;\n    const map = overlay._map;\n    const img = overlay.getElement();\n\n    if (!this.hasTool(L.ExportAction)) { return; }\n\n    // make a new image\n    const downloadable = new Image();\n\n    downloadable.id = downloadable.id || 'tempId12345';\n    document.body.appendChild(downloadable);\n\n    downloadable.onload = function onLoadDownloadableImage() {\n      const height = downloadable.height;\n      const width = downloadable.width;\n      const nw = map.latLngToLayerPoint(overlay.getCorner(0));\n      const ne = map.latLngToLayerPoint(overlay.getCorner(1));\n      const sw = map.latLngToLayerPoint(overlay.getCorner(2));\n      const se = map.latLngToLayerPoint(overlay.getCorner(3));\n\n      // I think this is to move the image to the upper left corner,\n      // eslint-disable-next-line max-len\n      // jywarren: i think we may need these or the image goes off the edge of the canvas\n      // jywarren: but these seem to break the distortion math...\n\n      // jywarren: i think it should be rejiggered so it\n      // finds the most negative values of x and y and then\n      // adds those to all coordinates\n\n      // nw.x -= nw.x;\n      // ne.x -= nw.x;\n      // se.x -= nw.x;\n      // sw.x -= nw.x;\n\n      // nw.y -= nw.y;\n      // ne.y -= nw.y;\n      // se.y -= nw.y;\n      // sw.y -= nw.y;\n\n      // run once warping is complete\n      downloadable.onload = function() {\n        L.DomUtil.remove(downloadable);\n      };\n\n      if (window && window.hasOwnProperty('warpWebGl')) {\n        warpWebGl(\n            downloadable.id,\n            [0, 0, width, 0, width, height, 0, height],\n            [nw.x, nw.y, ne.x, ne.y, se.x, se.y, sw.x, sw.y],\n            true // trigger download\n        );\n      }\n    };\n\n    downloadable.src = overlay.options.fullResolutionSrc || img.src;\n  },\n\n  _stackUp() {\n    const t = this._toggledImage;\n\n    if (!t || !this.hasTool(L.StackAction)) { return; }\n\n    this._toggledImage = false;\n    this._overlay.bringToFront();\n    this._refresh();\n  },\n\n  _stackDown() {\n    const t = this._toggledImage;\n\n    if (t || !this.hasTool(L.StackAction)) { return; }\n\n    this._toggledImage = true;\n    this._overlay.bringToBack();\n    this._refresh();\n  },\n\n  _unlock() {\n    const ov = this._overlay;\n    const map = ov._map;\n    const eP = this.parentGroup;\n\n    if (!this.isMode('lock')) { return; }\n    if ((eP && !eP.isCollected(ov)) || !eP) {\n      if (!this.hasTool(L.LockAction)) { return; }\n    }\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    if (ov.options.mode === 'lock' || !this.hasMode(ov.options.mode)) {\n      this._mode = '';\n      this.currentHandle = '';\n    } else {\n      this._mode = ov.options.mode;\n    }\n    this._updateHandle();\n    this._enableDragging();\n    this._refresh();\n  },\n\n  _lock() {\n    const ov = this._overlay;\n    const map = ov._map;\n    const eP = this.parentGroup;\n\n    if (this.isMode('lock')) { return; }\n    if ((eP && !eP.isCollected(ov)) || !eP) {\n      if (!this.hasTool(L.LockAction)) { return; }\n    }\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    this._mode = 'lock';\n    this._updateHandle();\n    this._disableDragging();\n    this._refresh();\n  },\n\n  _deselect() {\n    this._overlay.deselect();\n  },\n\n  _showMarkers(e) {\n    const eP = this.parentGroup;\n\n    if (!this.currentHandle) { return; }\n    // only markers we want in collect interface for now is lock\n    if (!this.isMode('lock') && (eP && eP.anyCollected())) { return; }\n\n    this.currentHandle.eachLayer((handle) => {\n      handle.setOpacity(1);\n      if (handle.dragging) { handle.dragging.enable(); }\n      L.DomUtil.addClass(handle.getElement(), 'leaflet-interactive');\n    });\n  },\n\n  _hideMarkers() {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n\n    // workaround for race condition w/ feature group\n    if (!this._handles) { this._initHandles(); }\n\n    if (!this.currentHandle) { return; }\n    if (this.isMode('lock') && (eP && eP.isCollected(ov))) { return; }\n\n    this.currentHandle.eachLayer((handle) => {\n      handle.setOpacity(0);\n      if (handle.dragging) { handle.dragging.disable(); }\n      L.DomUtil.removeClass(handle.getElement(), 'leaflet-interactive');\n    });\n  },\n\n  _updateHandle() {\n    const ov = this._overlay;\n    const map = ov._map;\n    const mode = this.getMode();\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    this.currentHandle = mode === '' ? '' : this._handles[mode];\n    if (this.currentHandle !== '') {\n      map.addLayer(this.currentHandle);\n    }\n  },\n\n  _addToolbar() {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n    const map = ov._map;\n    // Find the topmost point on the image.\n    const corners = ov.getCorners();\n    let maxLat = -Infinity;\n\n    if (eP && eP.anyCollected()) {\n      eP.editing._addToolbar();\n      return;\n    }\n\n    if (ov.options.suppressToolbar || this.toolbar) { return; }\n\n    for (let i = 0; i < corners.length; i++) {\n      if (corners[i].lat > maxLat) {\n        maxLat = corners[i].lat;\n      }\n    }\n\n    // Longitude is based on the centroid of the image.\n    const raisedPoint = ov.getCenter();\n    raisedPoint.lat = maxLat;\n\n    this.toolbar = L.distortableImage.popupBar(raisedPoint, {\n      actions: this.editActions,\n    }).addTo(map, ov);\n    ov.fire('toolbar:created');\n  },\n\n  _refresh() {\n    if (this.toolbar) { this._removeToolbar(); }\n    this._addToolbar();\n  },\n\n  _updateToolbarPos() {\n    const overlay = this._overlay;\n    // Find the topmost point on the image.\n    const corners = overlay.getCorners();\n    const toolbar = this.toolbar;\n    let maxLat = -Infinity;\n\n    if (toolbar && toolbar instanceof L.DistortableImage.PopupBar) {\n      for (let i = 0; i < corners.length; i++) {\n        if (corners[i].lat > maxLat) {\n          maxLat = corners[i].lat;\n        }\n      }\n\n      // Longitude is based on the centroid of the image.\n      const raisedPoint = overlay.getCenter();\n      raisedPoint.lat = maxLat;\n\n      if (!overlay.options.suppressToolbar) {\n        this.toolbar.setLatLng(raisedPoint);\n      }\n    }\n  },\n\n  hasMode(mode) {\n    return !!this._modes[mode];\n  },\n\n  getMode() {\n    if (!this.enabled()) { return; }\n    return this._mode;\n  },\n\n  getModes() {\n    return this._modes;\n  },\n\n  isMode(mode) {\n    if (!this.enabled()) { return false; }\n    return this._mode === mode;\n  },\n\n  setMode(newMode) {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n    const mode = this.getMode();\n\n    if (mode === newMode || !this.hasMode(newMode) || !this.enabled()) {\n      return;\n    }\n\n    if (this.toolbar) { this.toolbar.clickTool(newMode); }\n    if (this.isMode('lock') && !this.dragging) { this._enableDragging(); }\n    this._mode = newMode;\n    if (this.isMode('lock')) { this._disableDragging(); }\n    this._updateHandle();\n    this._refresh();\n\n    if (eP && eP.isCollected(ov)) { ov.deselect(); }\n\n    return this;\n  },\n\n  /**\n    * need to attach a stop to img dblclick or it will propagate to\n    * the map and fire the handler that shows map location labels on map dblclick.\n    */\n  nextMode(e) {\n    const mode = this.getMode();\n    const eP = this.parentGroup;\n    const modesArray = Object.keys(this.getModes());\n    const idx = modesArray.indexOf(mode);\n    const nextIdx = (idx + 1) % modesArray.length;\n    const newMode = modesArray[nextIdx];\n\n    if (e) {\n      if (eP && eP.anyCollected()) { return; }\n      L.DomEvent.stop(e);\n    }\n\n    return this.setMode(newMode);\n  },\n});\n\nL.distortableImage.edit = (overlay, options) => {\n  return new L.DistortableImage.Edit(overlay, options);\n};\n","L.Map.mergeOptions({\n  doubleClickLabels: true,\n});\n\n/**\n * The `doubleClickLabels` handler replaces `doubleClickZoom` by default if `#addGoogleMutant`\n * is used unless the options 'labels: false' or 'doubleClickZoom: false` were passed to it.\n */\nL.Map.DoubleClickLabels = L.Map.DoubleClickZoom.extend({\n  enable() {\n    const map = this._map;\n\n    if (this._enabled) { return this; }\n\n    // disable 'doubleClickZoom' if 'doubleClickLabels' is enabled.\n    if (map.doubleClickZoom.enabled()) {\n      map.doubleClickZoom.disable();\n    }\n\n    this._map.fire('singleclickon');\n\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    this._enabled = false;\n    this.removeHooks();\n\n    return this;\n  },\n\n  _fireIfSingle(e) {\n    const map = this._map;\n    const oe = e.originalEvent;\n\n    // prevents deselection in case of box selector\n    if (oe && oe.shiftKey) { return; }\n\n    map._clicked += 1;\n    this._map._clickTimeout = setTimeout(function() {\n      if (map._clicked === 1) {\n        map._clicked = 0;\n        map.fire('singleclick', {type: 'singleclick'});\n      } else {\n        // manually fire doubleclick event only for touch screens that don't natively fire it\n        if (L.Browser.touch && (oe && oe.sourceCapabilities.firesTouchEvents)) {\n          map.fire('dblclick');\n        }\n      }\n    }, 250);\n  },\n\n  _onDoubleClick() {\n    const map = this._map;\n    const labels = map._labels;\n\n    setTimeout(function() {\n      map._clicked = 0;\n      clearTimeout(map._clickTimeout);\n    }, 0);\n\n    if (!labels) { return; }\n\n    if (labels.options.opacity === 1) {\n      labels.options.opacity = 0;\n      labels.setOpacity(0);\n    } else {\n      labels.options.opacity = 1;\n      labels.setOpacity(1);\n    }\n  },\n});\n\nL.Map.addInitHook('addHandler', 'doubleClickLabels', L.Map.DoubleClickLabels);\n","L.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.action_map = {};\n\nL.EditAction = L.Toolbar2.Action.extend({\n  options: {\n    toolbarIcon: {\n      svg: false,\n      html: '',\n      className: '',\n      tooltip: '',\n    },\n  },\n\n  initialize(map, overlay, options) {\n    this._overlay = overlay;\n    this._map = map;\n\n    L.setOptions(this, options);\n    L.Toolbar2.Action.prototype.initialize.call(this, options);\n\n    this._injectIconSet();\n  },\n\n  _createIcon(toolbar, container, args) {\n    const iconOptions = this.options.toolbarIcon;\n    const className = iconOptions.className;\n    const edit = this._overlay.editing;\n    const style = this.options.toolbarIcon.style;\n\n    this.toolbar = toolbar;\n    this._icon = L.DomUtil.create('li', '', container);\n    this._link = L.DomUtil.create('a', '', this._icon);\n\n    if (iconOptions.svg) {\n      this._link.innerHTML = L.IconUtil.create(iconOptions.html);\n    } else {\n      this._link.innerHTML = iconOptions.html;\n    }\n\n    this._link.setAttribute('href', '#');\n    this._link.setAttribute('title', iconOptions.tooltip);\n    if (style) { this._link.setAttribute('style', style); };\n    this._link.setAttribute('role', 'button');\n\n    L.DomUtil.addClass(this._link, this.constructor.baseClass);\n\n    if (className) {\n      L.DomUtil.addClass(this._link, className);\n      if (className === 'disabled') {\n        L.DomUtil.addClass(this._icon, className);\n      }\n      if (className === edit._mode) {\n        L.DomUtil.addClass(this._link, 'selected-mode');\n      } else {\n        L.DomUtil.removeClass(this._link, 'selected-mode');\n      }\n    }\n\n    L.DomEvent.on(this._link, 'click', this.enable, this);\n    L.DomEvent.on(this._overlay, 'update', () => {\n      const match = this._link.innerHTML.match(/xlink:href=\"#restore\"/);\n      if (match && match.length === 1) { this._enableAction(); }\n    });\n\n    /* Add secondary toolbar */\n    this._addSubToolbar(toolbar, this._icon, args);\n  },\n\n  _injectIconSet() {\n    if (document.querySelector('#iconset')) {\n      return;\n    }\n\n    const el = document.createElement('div');\n    el.id = 'iconset';\n    el.setAttribute('hidden', 'hidden');\n    el.innerHTML = new L.ToolbarIconSet().render();\n\n    document.querySelector('.leaflet-marker-pane').appendChild(el);\n  },\n\n  _enableAction() {\n    L.DomUtil.removeClass(this._link.parentElement, 'disabled');\n    L.DomUtil.removeClass(this._link, 'disabled');\n  },\n\n  _disableAction() {\n    L.DomUtil.addClass(this._link.parentElement, 'disabled');\n    L.DomUtil.addClass(this._link, 'disabled');\n  },\n});\n\nL.editAction = function(map, overlay, options) {\n  return new L.EditAction(map, overlay, options);\n};\n","L.LockHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'lock',\n    interactive: false,\n    icon: L.icon({\n      // eslint-disable-next-line max-len\n      iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAD8SURBVO3BPU7CYAAA0AdfjIcQlRCQBG7C3gk2uIPG2RC3Dk16Gz0FTO1WZs/gwGCMP/2+xsSl7+n1er1Iz9LtRQjaPeMeO+TinLDCJV78YqjdA04YodKuxhUaPGoRxMmxwRQZSt87Yo4KExGCeAUyLLFB4bMacxywEClIU2KDKXbInTUYo8JCgoFuGoxQO5uiwY1EA91VmDqrcKeDoX8WdNNgjApvmGGLXKIgXY0xGkxQYItrrFFIEKQ5Yo4KEx9yrDFDhlKkIF6NOQ5Y+KpAhiXWKEQI4pxwiwoLPyuxwQw75FoE7fZYocFEuwI7jHCBV39gL92TXq/Xi/AOcmczZmaIMScAAAAASUVORK5CYII=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  onRemove(map) {\n    this.unbindTooltip();\n    L.EditHandle.prototype.onRemove.call(this, map);\n  },\n\n  _bindListeners() {\n    const icon = this.getElement();\n\n    L.EditHandle.prototype._bindListeners.call(this);\n\n    L.DomEvent.on(icon, {\n      mousedown: this._tooltipOn,\n      mouseup: this._tooltipOff,\n    }, this);\n\n    L.DomEvent.on(document, 'pointerleave', this._tooltipOff, this);\n  },\n\n  _unbindListeners() {\n    const icon = this.getElement();\n\n    L.EditHandle.prototype._bindListeners.call(this);\n\n    L.DomEvent.off(icon, {\n      mousedown: this._tooltipOn,\n      mouseup: this._tooltipOff,\n    }, this);\n\n    L.DomEvent.off(document, 'pointerleave', this._tooltipOff, this);\n  },\n\n  /* cannot be dragged */\n  _onHandleDrag() {\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n\n  _tooltipOn(e) {\n    const eP = this._handled.parentGroup;\n    const edit = eP ? eP.editing : this._handled.editing;\n\n    if (e.shiftKey) { return; }\n    if (!this._handled.isSelected() && (eP && !eP.isCollected(this._handled))) {\n      return;\n    }\n\n    const handlesArr = edit._lockHandles;\n\n    this._timer = setTimeout(L.bind(function() {\n      if (this._timeout) { clearTimeout(this._timeout); }\n\n      if (!this.getTooltip()) {\n        this.bindTooltip('Locked!', {permanent: true});\n      } else {\n        handlesArr.eachLayer(function(handle) {\n          if (this !== handle) { handle.closeTooltip(); }\n        });\n      }\n\n      this.openTooltip();\n    }, this), 500);\n  },\n\n  _tooltipOff(e) {\n    const eP = this._handled.parentGroup;\n    const edit = eP ? eP.editing : this._handled.editing;\n\n    if (e.shiftKey) { return; }\n    if (!this._handled.isSelected() && (eP && !eP.isCollected(this._handled))) {\n      return;\n    }\n\n    const handlesArr = edit._lockHandles;\n\n    if (e.currentTarget === document) {\n      handlesArr.eachLayer(function(handle) {\n        handle.closeTooltip();\n      });\n    }\n\n    if (this._timer) { clearTimeout(this._timer); }\n\n    this._timeout = setTimeout(L.bind(function() {\n      this.closeTooltip();\n    }, this), 400);\n  },\n});\n\nL.lockHandle = function(overlay, idx, options) {\n  return new L.LockHandle(overlay, idx, options);\n};\n","// startup\n// Load entry module and return exports\n__webpack_modules__[103]();\n__webpack_modules__[438]();\n__webpack_modules__[250]();\n__webpack_modules__[126]();\n__webpack_modules__[753]();\n__webpack_modules__[670]();\n__webpack_modules__[10]();\n__webpack_modules__[529]();\n__webpack_modules__[61]();\n__webpack_modules__[261]();\n__webpack_modules__[494]();\n__webpack_modules__[675]();\n__webpack_modules__[560]();\n__webpack_modules__[970]();\n__webpack_modules__[58]();\n__webpack_modules__[603]();\n__webpack_modules__[744]();\n__webpack_modules__[478]();\n__webpack_modules__[161]();\n__webpack_modules__[941]();\n__webpack_modules__[623]();\n__webpack_modules__[806]();\n__webpack_modules__[774]();\n__webpack_modules__[147]();\n__webpack_modules__[599]();\n__webpack_modules__[440]();\n__webpack_modules__[434]();\n__webpack_modules__[242]();\n__webpack_modules__[404]();\n__webpack_modules__[760]();\n__webpack_modules__[275]();\n__webpack_modules__[178]();\n__webpack_modules__[459]();\n__webpack_modules__[289]();\n__webpack_modules__[349]();\n__webpack_modules__[885]();\n__webpack_modules__[684]();\n__webpack_modules__[909]();\n__webpack_modules__[348]();\n// This entry module is referenced by other modules so it can't be inlined\n__webpack_modules__[527]();\n__webpack_modules__[401]();\n__webpack_modules__[853]();\n__webpack_modules__[921]();\nvar __webpack_exports__ = {};\n__webpack_modules__[229]();\n"],"names":["L","DistortableImageOverlay","ImageOverlay","extend","options","height","crossOrigin","edgeMinWidth","editable","mode","selected","interactive","tooltipText","initialize","url","setOptions","this","Utils","initTranslation","call","_selected","_url","rotation","onAdd","map","_this","_map","getElement","_initImage","on","_reset","corners","_corners","zoomAnimation","Browser","any3d","_animateZoom","DomEvent","getPane","appendChild","_initImageDimensions","units","deg","setAngle","rad","eventParents","_eventParents","eP","Object","keys","editing","enable","select","singleclickon","_singleClickListeners","singleclickoff","_resetClickListeners","singleclick","_singleClick","doubleClickZoom","enabled","doubleClickLabels","deselect","fire","activateTooltip","closeTooltip","onRemove","off","disable","prototype","deactivateTooltip","originalImageWidth","DomUtil","getStyle","originalImageHeight","aspectRatio","parseInt","imageHeight","imageWidth","center","project","getCenter","offset","point","divideBy","unproject","subtract","add","x","y","_initialDimensions","getZoom","setBounds","latLngBounds","getCorners","e","type","isSelected","edit","_removeToolbar","_hideMarkers","stopPropagation","_programmaticGrouping","_addToolbar","_showMarkers","anyCollected","eachLayer","layer","setCorner","corner","latlng","toolbar","DistortableImage","PopupBar","_updateToolbarPos","edited","_cornerExceedsMapLats","zoom","crs","Simple","CRS","exceedsTop","exceedsBottom","Math","pow","bindTooltip","direction","openTooltip","closeToolTip","unbindTooltip","getTooltipText","setCorners","latlngObj","i","k","setCornersFromPoints","pointsObj","layerPointToLatLng","scaleBy","scale","p","scaledCorners","getCorner","multiplyBy","getAngle","unit","arguments","length","undefined","matrix","style","TRANSFORM","split","slice","row0x","row0y","row1x","determinant","angle","TrigUtil","calcAngle","PI","round","radiansToDegrees","Util","formatNum","angleToRotateBy","rotateBy","q","degreesToRadians","cos","sin","dragBy","formerPoint","newPoint","transCorners","delta","restore","equals","_getTranslateString","is3d","webkit3d","close","image","latLngToLayerPoint","bind","transformMatrix","_calculateProjectiveTransform","topLeft","warp","getMatrixString","translation","_leaflet_pos","join","event","latLngToNewLayerPoint","_latLngToNewLayerPoint","reduce","agg","latLngToCartesian","j","w","offsetWidth","h","offsetHeight","c","push","_subtract","MatrixUtil","general2DProjection","distortableImageOverlay","id","Map","addInitHook","hasClass","getContainer","addClass","RotateHandle","EditHandle","TYPE","icon","iconUrl","iconSize","iconAnchor","_onHandleDrag","overlay","_handled","formerLatLng","_corner","newLatLng","getLatLng","calculateAngleDelta","updateHandle","setLatLng","rotateHandle","idx","EXIF","img","getAllTags","console","log","GPS","GPSLatitude","GPSLongitude","GPSLatitudeRef","GPSLongitudeRef","GPSImgDirectionRef","GPSImgDirection","numerator","denominator","Orientation","GPSAltitude","GPSAltitudeRef","alert","obj","m","gecko3d","ie3d","str","toggleClass","el","className","removeClass","confirmDelete","window","confirm","confirmImageDelete","confirmDeletes","n","warningMsg","confirmImagesDeletes","adj","multmm","a","b","cij","multmv","v","multsm","s","l","basisToPoints","x1","y1","x2","y2","x3","y3","x4","y4","x1s","y1s","x1d","y1d","x2s","y2s","x2d","y2d","x3s","y3s","x3d","y3d","x4s","y4s","x4d","y4d","d","DragAction","EditAction","toolbarIcon","svg","html","tooltip","dragImage","action_map","D","addHooks","_overlay","_dragMode","ToolbarIconSet","IconSet","_symbols","RotateAction","rotateImage","r","_rotateMode","include","_clicked","addGoogleMutant","opts","mutantOptions","mutantOpacity","maxZoom","maxNativeZoom","minZoom","labels","labelOpacity","_googleMutant","tileLayer","opacity","addTo","_addLabels","_labels","attribution","subdomains","ext","LockAction","use","Edit","u","lockMode","isMode","group_action_map","lockImages","_toggleLockMode","_lockGroup","ImageUtil","getCmPerPixel","distanceTo","width","Marker","markerOptions","draggable","zIndexOffset","hasOwnProperty","_bindListeners","_unbindListeners","_onHandleDragStart","_onHandleDragEnd","_fireEdit","contextmenu","stop","dragstart","drag","dragend","_calculateScalingFactor","latlngA","latlngB","centerPoint","formerRadiusSquared","_d2","newRadiusSquared","sqrt","dx","dy","initialAngle","atan2","RestoreAction","getNestedVal","restoreImage","ov","_enableAction","_disableAction","StackAction","_toggledImage","stackToFront","stackToBack","_mode","IconUtil","toggleXlink","_link","toggleTitle","_toggleOrder","DistortableCollection","Handler","keymap","distortableImage","group","_group","_exportOpts","exportOpts","Escape","editActions","actions","runExporter","startExport","document","_onKeyDown","_decollectAll","boxcollectend","_addCollections","removeHooks","_enabled","handlerName","key","oe","originalEvent","shiftKey","target","HTMLImageElement","_unlockGroup","hasTool","UnlockAction","isCollected","_unlock","_this2","_lock","_this3","box","boxCollectBounds","imgBounds","_latLngBoundsToNewLayerBounds","intersects","_removeGroup","_this4","DeleteAction","layersToRemove","_toRemove","forEach","removeLayer","cancelExport","customCollection","collection","clearInterval","updateInterval","suppressToolbar","controlBar","position","value","some","action","addTool","baseClass","removeTool","_this5","item","splice","_this6","ExportAction","Promise","resolve","statusUrl","generateExportJson","images","frequency","updater","data","JSON","parse","status_url","match","status","jpg","exportUrl","handleStatusRes","setInterval","req","Request","concat","Date","now","method","fetch","then","res","ok","text","fetchStatusUrl","mergedOpts","form","FormData","append","stringify","reqOpts","body","exportStartUrl","distortableCollection","unlockImages","DoubleClickZoom","click","_fireIfSingle","dblclick","_onDoubleClick","_clickTimeout","setTimeout","touch","sourceCapabilities","firesTouchEvents","_fireDOMEvent","clearTimeout","oldZoom","zoomDelta","setZoom","setZoomAround","containerPoint","opacities","subtoolbarCss","CSSStyleSheet","replaceSync","insertRule","adoptedStyleSheets","o","isNaN","_setOpacities","OpacitiesToolbar2","Toolbar2","filter","appendToContainer","container","constructor","_calculateDepth","_container","_ul","create","transform","_disabledEvents","_getActionConstructor","_createIcon","_arguments","OpacitiesAction","subToolbar","link","_hide","GeolocateAction","geolocateImage","getData","ref","test","replace","addClassToSvg","loader","querySelector","ref1","ref2","toggled","getAttribute","setAttribute","title1","title2","hasAttribute","FreeRotateAction","freeRotateImage","f","_freeRotateMode","ScaleAction","scaleImage","_scaleMode","KeymapperIconSet","DistortHandle","distortHandle","Keymapper","_keymapper","_buildContainer","_scrollWrapper","_wrap","_toggler","_createButton","_setMapper","_toggleKeymapper","disableClickPropagation","disableScrollPropagation","remove","divider","toggler","innerHTML","wrap","display","button","control","insertAdjacentHTML","preventDefault","_injectIconSet","_iconset","render","_n","mobile","keymapper","t","Symbol","iterator","toStringTag","Generator","_regeneratorDefine2","G","TypeError","done","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","defineProperty","enumerable","configurable","writable","_invoke","_OverloadYield","asyncGeneratorStep","_asyncToGenerator","apply","_next","_throw","arr","FeatureGroup","_addEvents","_removeEvents","_dragStartMultiple","_dragMultiple","mousedown","_deselectOthers","_longPressMultiSelect","getLayers","_toggleCollected","every","each","_leaflet_id","indexOf","_dragStartPoints","_updateCollectionFromPoints","_toMove","layersToMove","Transformation","movedPoints","_getAvgCmPerPixel","imgs","sum","cm_per_pixel","fetchRemoteJson","_regeneratorRuntime","mark","_callee","index","imgCollectionProps","response","_context","prev","next","axios","get","sent","abrupt","avg_cm_per_pixel","t0","recreateImagesFromJsonUrl","_callee2","imageCollectionObj","_context2","allImages","json","sections","_image","src","filename","zc","lat","lon","lng","image_file_name","nodes","reverse","FreeRotateHandle","corner1","latLngToContainerPoint","corner2","abs","freeRotateHandle","isExporting","mouseLeaveSkip","isHooksExecuted","exportImage","exportImages","_getExport","exportTool","parentElement","mouseEnterHandler","handleMouseEnter","mouseLeaveHandler","handleMouseLeave","resetState","detachMouseEventListeners","renderExportIcon","attachMouseEventListeners","renderDownloadIcon","element","addEventListener","removeEventListener","renderCancelIcon","firstChild","ScaleHandle","scaleHandle","BorderAction","_outlined","removeBorder","addBorder","_toggleBorder","deleteImage","deleteImages","distortImage","makeImageOpaque","makeImageTransparent","nestedKey","DragHandle","dragHandle","ControlBar","Control","ACTIONS","MODES","lock","unlock","Class","_svg","addSymbols","symbols","OpacityAction","_transparent","_toggleOpacity","DistortAction","_distortMode","Backspace","_removeOverlay","mergeOptions","boxCollector","boxZoom","BoxCollector","BoxZoom","_pane","_panes","overlayPane","_resetStateTimeout","_destroy","_onMouseDown","moved","_moved","_resetState","_clearDeferredResetState","which","disableTextSelection","disableImageDrag","_startPoint","mouseEventToContainerPoint","mousemove","_onMouseMove","mouseup","_onMouseUp","_box","_point","_bounds","bounds","size","getSize","setPosition","min","_finish","enableTextSelection","enableImageDrag","containerPointToLatLng","getBottomLeft","getTopRight","Popup","anchor","tools","children","clickTool","name","tool","popupBar","distort","rotate","freeRotate","outline","_opacity","bringToFront","_initModes","_initHandles","_appendHandlesandDragable","parentGroup","nextMode","handle","_disableDragging","_handles","_modes","_dragHandles","layerGroup","addLayer","_scaleHandles","_distortHandles","_rotateHandles","_freeRotateHandles","_lockHandles","lockHandle","_updateHandle","currentHandle","setOpacity","dragging","_enableDragging","replaceTool","old","_nextOrNone","getModes","Draggable","_updatePosition","currentPoint","_newPos","setMode","_refresh","_stackUp","_stackDown","downloadable","Image","onload","nw","ne","sw","se","warpWebGl","fullResolutionSrc","bringToBack","hasMode","_deselect","getMode","maxLat","raisedPoint","newMode","modesArray","DoubleClickLabels","Action","args","iconOptions","_icon","_addSubToolbar","createElement","editAction","LockHandle","_tooltipOn","_tooltipOff","handlesArr","_timer","_timeout","getTooltip","permanent","currentTarget","__webpack_modules__"],"sourceRoot":""}